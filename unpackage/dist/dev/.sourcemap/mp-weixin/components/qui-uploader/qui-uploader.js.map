{"version":3,"sources":["webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?10ad","webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?b92d","webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?8fc1","webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?4156","uni-app:///components/qui-uploader/qui-uploader.vue","webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?2865","webpack:///E:/wamp/www/hi-hupai-wechat-pro/components/qui-uploader/qui-uploader.vue?3598"],"names":[],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAqI;AACrI;AACgE;AACL;AACsC;;;AAGjG;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,kFAAM;AACR,EAAE,mGAAM;AACR,EAAE,4GAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,uGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,wLAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;;AAEH;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;ACtDA;AAAA;AAAA;AAAA;AAAsmB,CAAgB,goBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AC+C1nB,sD;;AAEA,oB;;AAEA;AACA,qBADA;AAEA;AACA;AACA;AACA,gBADA;AAEA,kBAFA,EAFA;;AAMA;AACA,iBADA;AAEA,kBAFA,EANA;;AAUA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,sBADA;AAEA,kBAFA,EAhBA;;AAoBA;AACA,qBADA;AAEA,kBAFA,EApBA;;AAwBA;AACA,qBADA;AAEA,kBAFA,EAxBA;;AA4BA;AACA,gBADA;AAEA,4BAFA,EA5BA;;AAgCA;AACA,oBADA;AAEA,mBAFA,EAhCA;;AAoCA;AACA,iBADA;AAEA;AACA;AACA,OAJA,EApCA;;AA0CA;AACA,kBADA;AAEA,kBAFA,EA1CA,EAFA;;;AAiDA,MAjDA,kBAiDA;AACA;AACA,0BADA;AAEA,oBAFA;AAGA,qBAHA;AAIA,wBAJA;AAKA,kBALA;AAMA,oBANA;AAOA,gBAPA;AAQA,mBARA;AASA,eATA;AAUA,qBAVA;AAWA,kBAXA;AAYA,kBAZA;AAaA,oBAbA;AAcA,gBAdA,EAcA;AACA,2BAfA,EAeA;AACA,qBAhBA,EAgBA;AACA,oBAjBA;;AAmBA,GArEA;AAsEA;AACA;AACA;AACA,aADA,mBACA,MADA,EACA;AACA;AACA;AACA,OAJA;AAKA,gBALA;AAMA,qBANA;;AAQA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAjBA,GAtEA;AAyFA,SAzFA,qBAyFA;AACA;AACA;AACA;AACA;AACA,iBAFA;AAGA;AACA;AACA;AACA,mBAFA;AAGA;AACA,eAVA,EAUA,gBAVA;AAWA;AACA;AACA,eAFA,MAEA;AACA;AACA,eAhBA;AAiBA,GA1GA;AA2GA;AACA,YADA,sBACA;AACA;AACA,KAHA;AAIA,gBAJA,wBAIA,KAJA,EAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OALA,MAKA;AACA;AACA;AACA;AACA,KAhBA;AAiBA,SAjBA,iBAiBA,KAjBA,EAiBA;AACA;AACA;AACA;AACA;AACA;AACA,KAvBA;;AAyBA;AACA,kBA1BA,0BA0BA,KA1BA,EA0BA,IA1BA,EA0BA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,sBADA;AAEA,qBAFA;AAGA,4BAHA;;;;;;AASA,KA1CA;AA2CA,WA3CA,mBA2CA,QA3CA,EA2CA;AACA;AACA;AACA;AACA;AACA,OAJA;AAKA,KAjDA;AAkDA;AACA,eAnDA,yBAmDA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA,gEADA;AAEA,8CAFA;AAGA,yCAHA;AAIA,iBAJA,mBAIA,GAJA,EAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,wCADA;AAEA,iDAFA;AAGA,gCAHA;AAIA,+BAJA;AAKA,uBALA;AAMA,sBANA;;AAQA,eAnBA;AAoBA,aAtBA;;AAwBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,iBAFA;AAGA;AACA;AACA,aAVA;AAWA,WA9CA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAgGA;AACA,KAlKA;AAmKA;AACA,UApKA,kBAoKA,OApKA,EAoKA,KApKA,EAoKA,MApKA,EAoKA,QApKA,EAoKA,OApKA,EAoKA,MApKA,EAoKA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA,8CADA;;AAGA;AACA;AACA;AACA,6CADA;AAEA,oBAFA;;AAIA;AACA;AACA;AACA;AACA,sBADA;AAEA,4BAFA;AAGA,yBAHA;AAIA,4BAJA;AAKA,wBALA;AAMA,6BANA;AAOA,eAPA,mBAOA,GAPA,EAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,kCADA;AAEA,6DAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA,iCADA;AAEA,0DAHA;AAIA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA,iBAFA;;AAIA;AACA;AACA;AACA;AACA;AACA,aA3CA,EA2CA,GA3CA;AA4CA,WA7CA,MA6CA;AACA;AACA;AACA;AACA;AACA,4BADA;AAEA,gIAFA;;AAIA,aALA,MAKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aATA,MASA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,aAFA,MAEA;AACA;AACA,aAFA,MAEA;AACA;AACA,aAFA,MAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAhGA;AAiGA,YAjGA,gBAiGA,GAjGA,EAiGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAzGA;AA0GA,gBA1GA,oBA0GA,GA1GA,EA0GA;AACA;AACA;AACA,qCADA;AAEA,gDAHA;AAIA;AACA;AACA,uFADA;AAEA;AACA,wCADA;;AAGA;AACA,SAtHA;;;AAyHA;AACA,gCADA,SACA,QADA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA,qBALA,MAKA;AACA;AACA;AACA;AACA;AACA;AACA,mBAdA;;AAgBA,KAhUA,EA3GA,E;;;;;;;;;;;;;ACnDA;AAAA;AAAA;AAAA;AAAgoC,CAAgB,0mCAAG,EAAC,C;;;;;;;;;;;ACAppC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"components/qui-uploader/qui-uploader.js","sourcesContent":["import { render, staticRenderFns, recyclableRender, components } from \"./qui-uploader.vue?vue&type=template&id=992d4578&scoped=true&\"\nvar renderjs\nimport script from \"./qui-uploader.vue?vue&type=script&lang=js&\"\nexport * from \"./qui-uploader.vue?vue&type=script&lang=js&\"\nimport style0 from \"./qui-uploader.vue?vue&type=style&index=0&id=992d4578&scoped=true&lang=scss&\"\n\n\n/* normalize component */\nimport normalizer from \"!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"992d4578\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"components/qui-uploader/qui-uploader.vue\"\nexport default component.exports","export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./qui-uploader.vue?vue&type=template&id=992d4578&scoped=true&\"","var components\ntry {\n  components = {\n    quiIcon: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-icon/qui-icon\" */ \"@/components/qui-icon/qui-icon.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var l0 = _vm.__map(_vm.uploadBeforeList, function(item, index) {\n    var $orig = _vm.__get_orig(item)\n\n    var g0 =\n      _vm.numberdata[index] && _vm.numberdata[index].state < 100\n        ? _vm.i18n.t(\"discuzq.image.imageUploading\")\n        : null\n    return {\n      $orig: $orig,\n      g0: g0\n    }\n  })\n\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        l0: l0\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./qui-uploader.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./qui-uploader.vue?vue&type=script&lang=js&\"","<template>\n  <view class=\"qui-uploader-box\">\n    <block>\n      <view\n        class=\"qui-uploader-box__uploader-file\"\n        v-for=\"(item, index) in uploadBeforeList\"\n        :key=\"index\"\n      >\n        <image\n          class=\"qui-uploader-box__uploader-file--image\"\n          v-if=\"uploadBeforeList.length > 0\"\n          mode=\"aspectFill\"\n          :src=\"item.path\"\n          @click=\"previewPicture(index, item)\"\n        ></image>\n        <view\n          class=\"qui-uploader-box__uploader-file--load\"\n          v-if=\"numberdata[index] && numberdata[index].state < 100\"\n        >\n          <view class=\"qui-uploader-box__uploader-file--load__mask\"></view>\n          <text class=\"qui-uploader-box__uploader-file--load__text\">\n            {{ i18n.t('discuzq.image.imageUploading') }}\n          </text>\n          <progress\n            :percent=\"item.uploadPercent\"\n            active\n            stroke-width=\"3\"\n            activeColor=\"#25A9F6\"\n            backgroundColor=\"#b5b5b5\"\n          />\n        </view>\n        <view class=\"qui-uploader-box__uploader-file__del\" v-else @click=\"uploadDelete(index)\">\n          <qui-icon class=\"icon-delete\" name=\"icon-delete\" color=\"#fff\" size=\"17\"></qui-icon>\n        </view>\n      </view>\n    </block>\n    <view\n      class=\"qui-uploader-box__add\"\n      @click=\"uploadClick\"\n      v-if=\"uploadBeforeList.length < dataCount\"\n    >\n      <qui-icon name=\"icon-add\" color=\"#B5B5B5\" size=\"40\"></qui-icon>\n    </view>\n  </view>\n</template>\n\n<script>\nimport { i18n } from '@/locale';\n\nlet uploadTimes = 0;\n\nexport default {\n  name: 'QuiUploader',\n  props: {\n    // 上传类型 0是首页上传，1是默认上传\n    chooseType: {\n      default: 1,\n      type: Number,\n    },\n    url: {\n      default: '',\n      type: String,\n    },\n    // header: {\n    //   type: Object,\n    //   default: () => {\n    //     return {};\n    //   },\n    // },\n    type: {\n      default: 'image',\n      type: String,\n    },\n    formData: {\n      default: Object,\n      type: Object,\n    },\n    name: {\n      default: 'file',\n      type: String,\n    },\n    count: {\n      default: 9,\n      type: [Number, String],\n    },\n    asyncClear: {\n      default: false,\n      type: Boolean,\n    },\n    filePreview: {\n      type: Array,\n      default: () => {\n        return [];\n      },\n    },\n    delayTime: {\n      default: 500,\n      type: Number,\n    },\n  },\n  data() {\n    return {\n      uploadBeforeList: [],\n      uploadList: [],\n      uploadIndex: '',\n      formDataAppend: {},\n      lastOrder: 0,\n      numberdata: [],\n      indexs: '',\n      erroindex: '',\n      number: 0,\n      detailindex: [],\n      newindex: [],\n      cunmumber: 1,\n      uploadType: '',\n      header: {}, // 上传图片header\n      dataCount: this.count, // 接收图片限制数量\n      chooseLength: 0, // 一次选择图片的长度\n      uploadCount: 0,\n    };\n  },\n  watch: {\n    // 监听得到的数据\n    formData: {\n      handler(newVal) {\n        this.formData = newVal;\n        this.uploadStatus = true;\n      },\n      deep: true,\n      immediate: true,\n    },\n    // uploadList: {\n    //   handler(newVal) {\n    //     this.uploadList = newVal;\n    //     this.$emit('change', this.uploadList, true);\n    //   },\n    //   deep: true,\n    //   immediate: true,\n    // },\n  },\n  async created() {\n    setTimeout(() => {\n      this.uploadBeforeList = this.uploadBeforeList.concat(this.filePreview);\n      this.uploadList.concat(this.filePreview).forEach(item => {\n        this.uploadList.push(item);\n      });\n      if (this.uploadBeforeList.length > 0) {\n        this.uploadBeforeList.map(() => {\n          return this.numberdata.push({ state: 100 });\n        });\n      }\n    }, this.delayTime);\n    if (this.filePreview.length) {\n      this.lastOrder = this.filePreview[this.filePreview.length - 1].order;\n    } else {\n      this.lastOrder = 0;\n    }\n  },\n  methods: {\n    getValue() {\n      return this.uploadList;\n    },\n    uploadDelete(index) {\n      this.uploadList.sort(this.compare('order'));\n      const beforeUpload = this.uploadList[index];\n      if (!this.asyncClear) {\n        this.uploadBeforeList.splice(index, 1);\n        this.uploadList.splice(index, 1);\n        this.numberdata.splice(index, 1);\n        this.$emit('clear', this.uploadList, beforeUpload);\n      } else {\n        // 开启异步删除图片后，返回删除图片的数据和下标，调用clear()需要把下标传进去\n        this.$emit('clear', beforeUpload, index);\n      }\n    },\n    clear(index) {\n      this.uploadList.sort(this.compare('order'));\n      const beforeUpload = this.uploadList[index];\n      this.uploadBeforeList.splice(index, 1);\n      this.numberdata.splice(index, 1);\n      return beforeUpload;\n    },\n\n    // 图片预览\n    previewPicture(index, item) {\n      // #ifdef MP-WEIXIN\n      const _this = this;\n      const preview = [];\n      for (let i = 0, len = _this.uploadBeforeList.length; i < len; i += 1) {\n        preview.push(_this.uploadBeforeList[i].path);\n      }\n      uni.previewImage({\n        current: index,\n        urls: preview,\n        indicator: 'default',\n      });\n      // #endif\n      // #ifdef H5\n      uni.$emit('clickImage', item);\n      // #endif\n    },\n    compare(property) {\n      return (a, b) => {\n        const value1 = a[property];\n        const value2 = b[property];\n        return value1 - value2;\n      };\n    },\n    // 上传图片到本地\n    uploadClick() {\n      const _this = this;\n      // 获取上一次上传图片的长度，用于比较这次上传长度。\n      const beforeUploadFile = _this.uploadBeforeList.length;\n      if (_this.chooseType === 0) {\n        _this.uploadList = [];\n        _this.uploadBeforeList = [];\n        // _this.dataCount = 0;\n        _this.dataCount = 9;\n        _this.lastOrder = 0;\n        uploadTimes = 0;\n      }\n      if (_this.uploadList.length < _this.dataCount || _this.name === 'avatar') {\n        // #ifdef MP-WEIXIN\n        wx.chooseImage({\n          count: _this.dataCount - _this.uploadBeforeList.length,\n          sizeType: ['original', 'compressed'],\n          sourceType: ['album', 'camera'],\n          success(res) {\n            _this.chooseLength = res.tempFiles.length;\n            uni.$emit('uploadLength', _this.chooseLength);\n            // 上传图片后返回false状态\n            _this.$emit('uploadClick', false);\n            // 自定义开始上传的效果和回调\n            _this.$emit('chooseSuccess');\n            const promise = res.tempFiles.map((item, index) => {\n              _this.lastOrder += 1;\n              return new Promise((resolve, reject) => {\n                res.tempFiles[index].uploadPercent = 0;\n                res.tempFiles[index].uploadStatus = false;\n                _this.uploadBeforeList.push(res.tempFiles[index]);\n                _this.numberdata.push({ state: 0 });\n                _this.newindex.push(res.tempFiles[index]);\n                // if (_this.uploadBeforeList.length > _this.count) {\n                //   _this.uploadBeforeList = _this.uploadBeforeList.slice(0, _this.count);\n                //   _this.numberdata = _this.numberdata.slice(0, _this.count);\n                //   _this.newindex = _this.newindex.slice(0, _this.count);\n                // }\n                _this.upload(\n                  res.tempFilePaths[index],\n                  _this.uploadBeforeList.length - 1,\n                  beforeUploadFile,\n                  _this.lastOrder,\n                  resolve,\n                  reject,\n                );\n              });\n            });\n\n            Promise.race(promise).then(() => {\n              // 返回上传成功列表和成功状态值\n              if (_this.uploadBeforeList.length > _this.dataCount) {\n                const uploadListSuccess = _this.uploadList.slice(0, _this.dataCount);\n                _this.uploadList.splice(0);\n                uploadListSuccess.forEach(item => {\n                  _this.uploadList.push(item);\n                });\n              }\n              _this.$emit('change', _this.uploadList, true);\n            });\n          },\n        });\n        // #endif\n        // #ifndef MP-WEIXIN\n        // 上传图片到本地\n        uni.chooseImage({\n          count: _this.dataCount - _this.uploadBeforeList.length,\n          sizeType: ['original', 'compressed'],\n          sourceType: ['album', 'camera'],\n          success(res) {\n            _this.chooseLength = res.tempFiles.length;\n            uni.$emit('uploadLength', _this.chooseLength);\n            // 上传图片后返回false状态\n            _this.$emit('uploadClickSure', false);\n\n            // 自定义开始上传的效果和回调\n            _this.$emit('chooseSuccess');\n            const promise = res.tempFiles.map((item, index) => {\n              _this.lastOrder += 1;\n              return new Promise((resolve, reject) => {\n                res.tempFiles[index].uploadPercent = 0;\n                res.tempFiles[index].uploadStatus = false;\n                _this.uploadBeforeList.push(res.tempFiles[index]);\n                _this.numberdata.push({ state: 0 });\n                _this.newindex.push(res.tempFiles[index]);\n                _this.upload(\n                  res.tempFilePaths[index],\n                  _this.uploadBeforeList.length - 1,\n                  beforeUploadFile,\n                  _this.lastOrder,\n                  resolve,\n                  reject,\n                );\n              });\n            });\n\n            Promise.race(promise).then(() => {\n              // 返回上传成功列表和成功状态值\n              if (_this.uploadBeforeList.length > _this.dataCount) {\n                const uploadListSuccess = _this.uploadList.slice(0, _this.dataCount);\n                _this.uploadList.splice(0);\n                uploadListSuccess.forEach(item => {\n                  _this.uploadList.push(item);\n                });\n              }\n              _this.$emit('change', _this.uploadList, true);\n            });\n          },\n        });\n        // #endif\n      }\n    },\n    // 上传图片到服务器\n    upload(pathUrl, index, length, imgOrder, resolve, reject) {\n      const _this = this;\n\n      // if (_this.chooseType === 0) {\n      //   _this.uploadCount = 0;\n      // }\n      const token = uni.getStorageSync('access_token');\n      _this.header = {\n        authorization: `Bearer ${token}`,\n      };\n      if (_this.chooseType === 0) {\n        // 这是首页上传图片\n        uni.showLoading({\n          title: _this.i18n.t('core.loading'),\n          mask: true,\n        });\n      }\n      const formdataObj = { type: _this.formData.type, order: imgOrder };\n      _this.formDataAppend = {};\n      const uploadTask = uni.uploadFile({\n        url: _this.url,\n        fileType: _this.type,\n        filePath: pathUrl,\n        header: _this.header,\n        name: _this.name,\n        formData: formdataObj,\n        success(res) {\n          if (res.statusCode >= 200 && res.statusCode < 300) {\n            setTimeout(() => {\n              uploadTimes += 1;\n              if (_this.chooseType === 0 && index <= 8) {\n                uni.$emit('uploadOver', { data: JSON.parse(res.data), times: uploadTimes });\n              }\n              if (index < _this.uploadBeforeList.length) {\n                _this.uploadBeforeList[index].uploadPercent = 100;\n                _this.uploadBeforeList[index].id = JSON.parse(res.data).data.id;\n                _this.numberdata[index].state = 100;\n              }\n              if (\n                _this.erroindex !== '' &&\n                _this.erroindex >= 0 &&\n                _this.erroindex < _this.uploadBeforeList.length\n              ) {\n                _this.uploadBeforeList[_this.erroindex].uploadPercent = 100;\n                _this.numberdata[_this.erroindex].state = 100;\n              }\n              if (\n                _this.indexs >= 0 &&\n                _this.indexs !== '' &&\n                _this.indexs < _this.uploadBeforeList.length\n              ) {\n                _this.uploadBeforeList[_this.indexs].uploadPercent = 100;\n                _this.numberdata[_this.indexs].state = 100;\n              }\n              _this.uploadList.push(JSON.parse(res.data).data);\n              if (_this.uploadList.length > _this.dataCount) {\n                _this.uploadList.sort(_this.compare('order'));\n                _this.uploadBeforeList = _this.uploadBeforeList.slice(0, _this.count);\n                // _this.uploadList = _this.uploadList.slice(0, _this.dataCount);\n\n                const uploadListSuccess = _this.uploadList.slice(0, _this.dataCount);\n                _this.uploadList.splice(0);\n                uploadListSuccess.forEach(item => {\n                  _this.uploadList.push(item);\n                });\n\n                _this.numberdata = _this.numberdata.slice(0, _this.dataCount);\n                _this.newindex = _this.newindex.slice(0, _this.dataCount);\n              }\n              _this.newindex = [];\n              _this.formDataAppend = {};\n            }, 500);\n          } else {\n            _this.number += 1;\n            const resObj = JSON.parse(res.data);\n            if (resObj.errors[0].detail) {\n              uni.showToast({\n                icon: 'none',\n                title: `${i18n.t(`core.${resObj.errors[0].code}`)}\\n${resObj.errors[0].detail[0]}`,\n              });\n            } else {\n              uni.showToast({ icon: 'none', title: resObj.errors[0].code });\n            }\n            if (_this.uploadBeforeList.length > 1) {\n              for (let i = 0; i < _this.uploadBeforeList.length; i += 1) {\n                if (_this.uploadBeforeList[i] === _this.newindex[index]) {\n                  _this.uploadBeforeList.splice(i, 1);\n                  _this.uploadList.splice(i, 1);\n                  _this.numberdata.splice(i, 1);\n                  _this.erroindex = i;\n                }\n              }\n            } else {\n              _this.uploadBeforeList.splice(0, 1);\n              _this.uploadList.splice(0, 1);\n              _this.numberdata.splice(0, 1);\n            }\n            if (index > 0 && index === _this.uploadBeforeList.length) {\n              _this.indexs = index - 1;\n            } else if (index > 0 && index < _this.uploadBeforeList.length) {\n              _this.indexs = index;\n            } else if (index > 0 && index >= _this.uploadBeforeList.length) {\n              _this.indexs = index - _this.number;\n            } else if (index === 0) {\n              _this.indexs = 0;\n            }\n            _this.$emit('uploadFail', res, _this.uploadList);\n            // uni.$emit('uploadFail', res);\n            return reject(res);\n          }\n          _this.formDataAppend = {};\n          // 抛出接口信息\n          _this.$emit('uploadSuccess', res, _this.uploadList);\n          // _this.numberdata.splice(index, 1);\n          return resolve(_this.uploadList);\n        },\n        fail(res) {\n          _this.uploadBeforeList.splice(index, 1);\n          _this.uploadList.splice(index, 1);\n          _this.numberdata.splice(index, 1);\n          // 上传失败回调\n          _this.$emit('uploadFail', res, _this.uploadList);\n          // uni.$emit('uploadFail', res);\n          return reject(res);\n        },\n        complete(res) {\n          if (\n            _this.chooseType === 0 &&\n            JSON.parse(res.data).errors &&\n            JSON.parse(res.data).errors.length > 0\n          ) {\n            _this.chooseLength =\n              _this.chooseLength > _this.dataCount ? _this.dataCount : _this.chooseLength;\n            uni.$emit('uploadFail', {\n              data: JSON.parse(res.data),\n            });\n          }\n        },\n      });\n\n      uploadTask.onProgressUpdate(async res => {\n        const progress = await res.progress;\n        for (let i = length; i < _this.uploadBeforeList.length; i += 1) {\n          if (progress < 100) {\n            _this.uploadBeforeList[i].uploadPercent = progress;\n            if (_this.numberdata[i]) {\n              _this.numberdata[i].state = _this.uploadBeforeList[i].uploadPercent;\n            }\n          } else if (progress === 100) {\n            _this.uploadBeforeList[i].uploadPercent = 90;\n            if (_this.numberdata[i]) {\n              _this.numberdata[i].state = _this.uploadBeforeList[i].uploadPercent;\n            }\n          }\n        }\n      });\n    },\n  },\n};\n</script>\n\n<style scoped lang=\"scss\">\n@import '@/styles/base/theme/fn.scss';\n@import '@/styles/base/variable/global.scss';\n\n.qui-uploader-box {\n  display: grid;\n  grid-template-columns: repeat(3, 1fr);\n  grid-gap: 13rpx;\n  width: 100%;\n  min-height: 160rpx;\n  padding-top: 30rpx;\n\n  &__uploader-file {\n    position: relative;\n    width: 100%;\n    height: calc((100vw - 80rpx) / 3);\n    box-sizing: border-box;\n\n    &__box {\n      position: absolute;\n      top: 0;\n      left: 0;\n      width: 100%;\n      height: 100%;\n      margin: 10rpx;\n    }\n\n    &--image {\n      z-index: 0;\n      width: 100%;\n      height: 100%;\n      border: 1px solid --color(--qui-BOR-ED);\n      border-radius: 5rpx;\n    }\n    &--load {\n      position: absolute;\n      top: 0;\n      z-index: 1;\n      display: flex;\n      flex-direction: column;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 100%;\n      text-align: center;\n      border: 1px solid --color(--qui-BOR-ED);\n      border-radius: 5rpx;\n      &__mask {\n        position: absolute;\n        width: 100%;\n        height: 100%;\n        background-color: --color(--qui-BG-ED);\n        border: 1px solid --color(--qui-BOR-ED);\n        border-radius: 5rpx;\n        opacity: 0.7;\n      }\n\n      &__text {\n        position: relative;\n        z-index: 2;\n        font-size: $fg-f4;\n        line-height: 160rpx;\n        color: --color(--qui-FC-34);\n      }\n\n      progress {\n        position: absolute;\n        bottom: 9.5rpx;\n        z-index: 3;\n        width: 87.5%;\n      }\n    }\n    &__del {\n      position: absolute;\n      bottom: 0;\n      left: 1px;\n      z-index: 1;\n      display: flex;\n      justify-content: center;\n      align-items: center;\n      width: 100%;\n      height: 30rpx;\n      background: --color(--qui-BG-00);\n      border-radius: 0 0 5rpx 5rpx;\n      opacity: 0.5;\n      .icon-delete {\n        display: flex;\n        justify-content: center;\n        align-items: center;\n        height: 100%;\n      }\n    }\n  }\n\n  &__add {\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    width: 100%;\n    height: calc((100vw - 80rpx) / 3);\n    background-color: --color(--qui-FC-f7);\n    border: 1px solid --color(--qui-BOR-ED);\n    border-radius: 5rpx;\n  }\n}\n.van-uploader__input {\n  width: 200rpx;\n  height: 200rpx;\n  background: burlywood;\n}\n</style>\n","import mod from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./qui-uploader.vue?vue&type=style&index=0&id=992d4578&scoped=true&lang=scss&\"; export default mod; export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./qui-uploader.vue?vue&type=style&index=0&id=992d4578&scoped=true&lang=scss&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1636533852953\n      var cssReload = require(\"G:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}