{"version":3,"sources":["uni-app:///main.js","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?3426","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?7b10","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?188a","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?cb74","uni-app:///pages/notice/msglist.vue","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?7eb1","webpack:///E:/wamp/www/hi-hupai-wechat-pro/pages/notice/msglist.vue?c64a"],"names":["createPage","Page"],"mappings":";;;;;;;;;;kDAAA;AACA;AACA,kG;AACAA,UAAU,CAACC,gBAAD,CAAV,C;;;;;;;;;;;;;ACHA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAgI;AAChI;AAC2D;AACL;AACsC;;;AAG5F;AACqK;AACrK,gBAAgB,+KAAU;AAC1B,EAAE,6EAAM;AACR,EAAE,8FAAM;AACR,EAAE,uGAAe;AACjB;AACA;AACA;AACA;AACA;AACA,EAAE,kGAAU;AACZ;AACA;;AAEA;AACe,gF;;;;;;;;;;;;ACvBf;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA,aAAa,8OAEN;AACP,KAAK;AACL;AACA,aAAa,0PAEN;AACP,KAAK;AACL;AACA,aAAa,0PAEN;AACP,KAAK;AACL;AACA,aAAa,wLAEN;AACP,KAAK;AACL;AACA,aAAa,8LAEN;AACP;AACA;AACA,CAAC;AACD;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,GAAG;AACH;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,MAAM;AACN;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;;;;;;;;;;AChEA;AAAA;AAAA;AAAA;AAAimB,CAAgB,2nBAAG,EAAC,C;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACwFrnB,yD;;AAEA;AACA;AACA,sBADA,EADA;;;AAKA,MALA,kBAKA;AACA;AACA,kBADA,EACA;AACA,kBAFA;AAGA;AACA,oBADA;AAEA,oBAFA,EAHA;;AAOA,aAPA,EAOA;AACA,sBARA,EAQA;AACA,iBATA,EASA;AACA,eAVA;AAWA,YAXA;AAYA,uBAZA,EAYA;AACA,kBAbA,EAaA;AACA,gBAdA,EAcA;AACA,qBAfA;AAgBA,eAhBA,EAgBA;AACA,iBAjBA,CAiBA;AAjBA;AAmBA,GAzBA;;AA2BA;AACA;AACA,kBAFA,4BAEA;AACA;AACA;AACA,KALA;AAMA;AACA,iBAPA,2BAOA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,KAtBA;;AAwBA;AACA,YAzBA,sBAyBA;AACA;AACA,KA3BA;;AA6BA;AACA,YA9BA,sBA8BA;AACA;AACA,KAhCA,EA3BA;;;AA8DA;AACA,iBADA,2BACA;AACA;AACA,KAHA,EA9DA;;AAmEA,SAnEA,qBAmEA;AACA;AACA;AACA;AACA,uBADA;AAEA,mCAFA;AAGA,oCAJA,CADA;;AAOA;AACA;AACA;AACA;AACA;AACA,OAJA,CAIA;AACA;AACA;AACA,KAfA,MAeA;AACA;AACA;AACA;AACA,GAvFA;AAwFA,QAxFA,kBAwFA,MAxFA,EAwFA;AACA,qEADA;AAEA,YAFA,GAEA,MAFA,CAEA,QAFA,CAEA,QAFA,GAEA,MAFA,CAEA,QAFA;AAGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA,OALA,MAKA;AACA;AACA;AACA;AACA,SAFA;AAGA;AACA,KAZA;AAaA,GAlHA;;AAoHA;AACA,kBADA,4BACA;AACA;AACA;AACA,2BADA;AAEA,iBAFA,CAEA,gBAFA;AAGA,0BAHA;AAIA,YAJA,CAIA;AACA;AACA;AACA;AACA,WAFA;AAGA;AACA;AACA;AACA;AACA,SAbA;AAcA,OAfA;AAgBA,KAlBA;AAmBA,WAnBA,qBAmBA;AACA;AACA;AACA;AACA,KAvBA;AAwBA,UAxBA,kBAwBA,CAxBA,EAwBA;AACA;AACA;AACA;AACA,KA5BA;AA6BA;AACA,iBA9BA,yBA8BA,QA9BA,EA8BA;AACA;AACA;AACA;AACA,wDADA;AAEA,0CAFA;AAGA,sCAHA;AAIA,sCAJA;AAKA,4BALA;;AAOA;AACA;AACA,gBADA,CACA,QADA,EACA,sCADA;AAEA,YAFA,CAEA;AACA;AACA;AACA;AACA;AACA,SAPA;AAQA,aARA,CAQA;AACA;AACA,SAVA;AAWA;AACA,KArDA;AAsDA;AACA,YAvDA,sBAuDA;AACA;AACA,KAzDA;AA0DA,cA1DA,sBA0DA,CA1DA,EA0DA;AACA;AACA;AACA;AACA;AACA,wBADA;AAEA,yDAFA;AAGA,0BAHA;;AAKA;AACA;AACA,KArEA;AAsEA,eAtEA,uBAsEA,CAtEA,EAsEA;AACA;AACA;AACA;AACA,KA1EA;AA2EA;AACA,QA5EA,kBA4EA;AACA;AACA;AACA,sBADA;AAEA,mDAFA;AAGA,wBAHA;;AAKA,OANA,MAMA;AACA;AACA,sBADA;AAEA,uDAFA;AAGA,wBAHA;;AAKA,OANA,MAMA;AACA;AACA;AACA;AACA;AACA;AACA,4BADA,EADA;;AAIA,6CAJA;AAKA,kCALA;;AAOA;AACA;AACA,kBADA,CACA,SADA,EACA,MADA;AAEA,cAFA,CAEA;AACA;AACA;AACA;AACA;AACA,WAPA;AAQA,eARA,CAQA;AACA;AACA;AACA;AACA,8BADA;AAEA,6DAFA;AAGA,gCAHA;;AAKA;AACA;AACA;AACA,8BADA;AAEA,gEAFA;AAGA,gCAHA;;AAKA;AACA;AACA,WAzBA;AA0BA,SAnCA,MAmCA;AACA;AACA;AACA,oCADA,EADA;;AAIA,oCAJA;AAKA,kCALA;;AAOA;AACA;AACA,kBADA,CACA,SADA,EACA,OADA;AAEA,cAFA,CAEA;AACA;AACA;AACA;AACA,WANA;AAOA,eAPA,CAOA;AACA;AACA;AACA;AACA,8BADA;AAEA,6DAFA;AAGA,gCAHA;;AAKA;AACA;AACA;AACA,8BADA;AAEA,gEAFA;AAGA,gCAHA;;AAKA;AACA;AACA,WAxBA;AAyBA;AACA;AACA;AACA;AACA,KArKA;AAsKA;AACA,YAvKA,sBAuKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OARA,MAQA;AACA;AACA;AACA;AACA;AACA;AACA,SAFA;AAGA;AACA;AACA,KAzLA;AA0LA;AACA,iBA3LA,yBA2LA,IA3LA,EA2LA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,OAHA;AAIA,KArMA;AAsMA,gBAtMA,wBAsMA,EAtMA,EAsMA;AACA;AACA;AACA,wDADA;;AAGA;AACA,KA5MA,EApHA,E;;;;;;;;;;;;;AC1FA;AAAA;AAAA;AAAA;AAA2nC,CAAgB,qmCAAG,EAAC,C;;;;;;;;;;;ACA/oC;AACA,OAAO,KAAU,EAAE,kBAKd","file":"pages/notice/msglist.js","sourcesContent":["import 'uni-pages';\nimport Vue from 'vue'\nimport Page from './pages/notice/msglist.vue'\ncreatePage(Page)","import { render, staticRenderFns, recyclableRender, components } from \"./msglist.vue?vue&type=template&id=b1f18fbe&scoped=true&\"\nvar renderjs\nimport script from \"./msglist.vue?vue&type=script&lang=js&\"\nexport * from \"./msglist.vue?vue&type=script&lang=js&\"\nimport style0 from \"./msglist.vue?vue&type=style&index=0&id=b1f18fbe&lang=scss&scoped=true&\"\n\n\n/* normalize component */\nimport normalizer from \"!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\runtime\\\\componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"b1f18fbe\",\n  null,\n  false,\n  components,\n  renderjs\n)\n\ncomponent.options.__file = \"pages/notice/msglist.vue\"\nexport default component.exports","export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\templateLoader.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--16-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\template.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-uni-app-loader\\\\page-meta.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=template&id=b1f18fbe&scoped=true&\"","var components\ntry {\n  components = {\n    quiPage: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-page/qui-page\" */ \"@/components/qui-page/qui-page.vue\"\n      )\n    },\n    quiAvatar: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-avatar/qui-avatar\" */ \"@/components/qui-avatar/qui-avatar.vue\"\n      )\n    },\n    quiUparse: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-uparse/qui-uparse\" */ \"@/components/qui-uparse/qui-uparse.vue\"\n      )\n    },\n    quiIcon: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-icon/qui-icon\" */ \"@/components/qui-icon/qui-icon.vue\"\n      )\n    },\n    quiEmoji: function() {\n      return import(\n        /* webpackChunkName: \"components/qui-emoji/qui-emoji\" */ \"@/components/qui-emoji/qui-emoji.vue\"\n      )\n    }\n  }\n} catch (e) {\n  if (\n    e.message.indexOf(\"Cannot find module\") !== -1 &&\n    e.message.indexOf(\".vue\") !== -1\n  ) {\n    console.error(e.message)\n    console.error(\"1. 排查组件名称拼写是否正确\")\n    console.error(\n      \"2. 排查组件是否符合 easycom 规范，文档：https://uniapp.dcloud.net.cn/collocation/pages?id=easycom\"\n    )\n    console.error(\n      \"3. 若组件不符合 easycom 规范，需手动引入，并在 components 中注册该组件\"\n    )\n  } else {\n    throw e\n  }\n}\nvar render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  var g0 = _vm.$u.light()\n  var g1 = _vm.i18n.t(\"notice.send\")\n  _vm.$mp.data = Object.assign(\n    {},\n    {\n      $root: {\n        g0: g0,\n        g1: g1\n      }\n    }\n  )\n}\nvar recyclableRender = false\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns, recyclableRender, components }","import mod from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\babel-loader\\\\lib\\\\index.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--12-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\script.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=script&lang=js&\"","<template>\n  <qui-page :data-qui-theme=\"theme\">\n    <view class=\"chat-box\">\n      <!-- 消息内容 -->\n      <scroll-view\n        :style=\"{ height: scv + 'rpx' }\"\n        scroll-y=\"true\"\n        :scroll-top=\"scrollTop\"\n        @scroll=\"scroll\"\n        @scrolltoupper=\"toUpper\"\n      >\n        <view class=\"chat-box__con\" v-for=\"item in allChatRecord\" :key=\"item._jv.id\">\n          <view class=\"chat-box__con__time\">{{ item.time }}</view>\n          <view\n            :class=\"[\n              item.user_id === currentLoginId\n                ? 'chat-box__con__msg__mine'\n                : 'chat-box__con__msg__other',\n            ]\"\n          >\n            <qui-avatar\n              :is-real=\"item.user && item.user.isReal\"\n              class=\"chat-box__con__msg__other__img\"\n              :user=\"item.user\"\n              @click=\"jumpUserPage(item.user_id)\"\n            />\n            <view\n              :class=\"[\n                item.user_id === currentLoginId\n                  ? 'chat-box__con__msg__mine__box'\n                  : 'chat-box__con__msg__other__box',\n              ]\"\n            >\n              <qui-uparse\n                :content=\"item.message_text_html\"\n                style=\"word-break: break-all;\"\n              ></qui-uparse>\n            </view>\n          </view>\n        </view>\n        <view\n          :style=\"{\n            height: bottomPadding + 'px',\n            background: theme === $u.light() ? '#EDEDED' : '#3F4243',\n          }\"\n        ></view>\n      </scroll-view>\n\n      <!-- 底部 -->\n      <view class=\"chat-box__footer\">\n        <view class=\"chat-box__footer__msg\">\n          <textarea\n            class=\"uni-input\"\n            :maxlength=\"450\"\n            :cursor=\"cursor\"\n            :focus=\"focus\"\n            :show-confirm-bar=\"false\"\n            :adjust-position=\"false\"\n            v-model=\"msg\"\n            @blur=\"cursorBlur\"\n            @focus=\"cursorFocus\"\n          />\n          <qui-icon\n            name=\"icon-expression chat-box__footer__msg__icon\"\n            size=\"40\"\n            :color=\"emojiShow ? '#1878F3' : '#7D7979'\"\n            @click=\"popEmoji\"\n          ></qui-icon>\n          <button class=\"chat-box__footer__btn\" type=\"primary\" @click=\"send\">\n            {{ i18n.t('notice.send') }}\n          </button>\n        </view>\n        <qui-emoji\n          :list=\"allEmoji\"\n          position=\"relative\"\n          top=\"0rpx\"\n          left=\"20rpx\"\n          right=\"20rpx\"\n          v-if=\"emojiShow\"\n          @click=\"getEmojiClick\"\n        ></qui-emoji>\n      </view>\n    </view>\n  </qui-page>\n</template>\n\n<script>\nimport quiEmoji from '@/components/qui-emoji/qui-emoji';\nimport { time2DateAndHM } from '@/utils/time';\n\nexport default {\n  components: {\n    quiEmoji,\n  },\n\n  data() {\n    return {\n      username: '', // 接收消息的用户\n      scrollTop: 0,\n      old: {\n        scrollTop: 0,\n        focus: false,\n      },\n      msg: '', // 输入框内容\n      emojiShow: false, // 默认不展示表情框\n      dialogId: 0, // 会话id\n      height: 0,\n      scv: 0,\n      bottomPadding: 10, // 底部填充\n      pageSize: 20, // 每页20条数据\n      pageNum: 1, // 当前页数\n      navbarHeight: 0,\n      cursor: 0, // 光标位置\n      focus: true, // 获取焦点\n    };\n  },\n\n  computed: {\n    // 获取当前登录的id\n    currentLoginId() {\n      const userId = this.$store.getters['session/get']('userId');\n      return parseInt(userId, 10);\n    },\n    // 获取会话消息列表\n    allChatRecord() {\n      const list = [];\n      const recordList = this.$store.getters['jv/get']('dialog_message');\n      const keys = Object.keys(recordList);\n      if (recordList && keys.length > 0) {\n        for (let i = 0; i < keys.length; i += 1) {\n          const row = recordList[keys[i]];\n          if (row.dialog_id.toString() === this.dialogId) {\n            row.time = time2DateAndHM(row.created_at);\n            row.user = this.$store.getters['jv/get'](`users/${row.user_id}`);\n            list.push(row);\n          }\n        }\n      }\n      return list;\n    },\n\n    // 获取所有表情\n    allEmoji() {\n      return this.$store.getters['jv/get']('emoji');\n    },\n\n    // 获取用户信息\n    userInfo() {\n      return this.$store.getters['jv/get'](`users/${this.currentLoginId}`);\n    },\n  },\n\n  watch: {\n    allChatRecord() {\n      this.scrollToBottom();\n    },\n  },\n  created() {\n    if (\n      !(\n        getApp() &&\n        getApp().systemInfo &&\n        getApp().systemInfo.screenWidth &&\n        getApp().systemInfo.windowHeight\n      )\n    ) {\n      try {\n        getApp().systemInfo = uni.getSystemInfoSync();\n        const screenK = getApp().systemInfo.screenWidth / 750;\n        this.scv = getApp().systemInfo.windowHeight / screenK - 140;\n      } catch (e) {\n        console.error(`Painter get system info failed, ${JSON.stringify(e)}`);\n      }\n    } else {\n      const screenK = getApp().systemInfo.screenWidth / 750;\n      this.scv = getApp().systemInfo.windowHeight / screenK - 140;\n    }\n  },\n  onLoad(params) {\n    this.navbarHeight = uni.getSystemInfoSync().statusBarHeight + 44;\n    const { username, dialogId } = params;\n    if (dialogId) {\n      this.dialogId = dialogId;\n    }\n    if (username) {\n      this.username = username;\n    }\n    this.getChatRecord(dialogId);\n    if (Object.keys(this.allEmoji).length < 1) {\n      this.getEmoji();\n    }\n    uni.onKeyboardHeightChange(res => {\n      if (res.height > 0) {\n        // 键盘弹出（滚动条位置增加键盘高度）\n        this.$nextTick(() => {\n          this.scrollTop += res.height;\n        });\n      } else {\n        // 键盘收起（滚动条位置减少键盘高度）\n        this.$nextTick(() => {\n          this.scrollTop -= res.height;\n        });\n      }\n    });\n  },\n\n  methods: {\n    scrollToBottom() {\n      this.$nextTick(() => {\n        uni\n          .createSelectorQuery()\n          .selectAll('.chat-box__con')\n          .boundingClientRect()\n          .exec(data => {\n            let height = 0;\n            data[0].forEach(item => {\n              height += item.height;\n            });\n            if (height > 600) {\n              this.scrollTop = height - 658 + 10;\n              this.old.scrollTop = height - 658 + 10;\n            }\n          });\n      });\n    },\n    toUpper() {\n      uni.startPullDownRefresh();\n      this.pageNum += 1;\n      this.getChatRecord(this.dialogId);\n    },\n    scroll(e) {\n      if (e && e.detail) {\n        this.old.scrollTop = e.detail.scrollTop;\n      }\n    },\n    // 调用 会话消息列表 的接口\n    getChatRecord(dialogId) {\n      if (dialogId !== '0') {\n        uni.showNavigationBarLoading();\n        const params = {\n          'filter[dialog_id]': dialogId || this.dialogId,\n          include: ['user', 'user.groups'],\n          'page[number]': this.pageNum,\n          'page[limit]': this.pageSize,\n          sort: '-createdAt',\n        };\n        this.$store.commit('jv/clearRecords', { _jv: { type: 'dialog/message' } });\n        this.$store\n          .dispatch('jv/get', ['dialog/message', { params }])\n          .then(res => {\n            if (res) {\n              uni.hideNavigationBarLoading();\n              uni.stopPullDownRefresh();\n            }\n          })\n          .catch(err => {\n            console.log(err);\n          });\n      }\n    },\n    // 调用 表情 的接口\n    getEmoji() {\n      this.$store.dispatch('jv/get', ['emoji', {}]);\n    },\n    cursorBlur(e) {\n      if (e && e.detail) {\n        this.cursor = e.detail.cursor;\n        if (e.detail.value.length > 450) {\n          uni.showToast({\n            icon: 'none',\n            title: this.i18n.t('notice.contentMaxLength'),\n            duration: 2000,\n          });\n        }\n      }\n    },\n    cursorFocus(e) {\n      if (e) {\n        this.emojiShow = false;\n      }\n    },\n    // 发送消息\n    send() {\n      if (this.msg === '') {\n        uni.showToast({\n          icon: 'none',\n          title: this.i18n.t('notice.emptycontent'),\n          duration: 2000,\n        });\n      } else if (this.msg.length > 450) {\n        uni.showToast({\n          icon: 'none',\n          title: this.i18n.t('notice.contentMaxLength'),\n          duration: 2000,\n        });\n      } else {\n        console.log('---------this.dialogId', this.dialogId);\n        console.log('---------type', typeof this.dialogId);\n        if (this.dialogId === '0') {\n          const params = {\n            _jv: {\n              type: 'dialog',\n            },\n            recipient_username: this.username,\n            message_text: this.msg,\n          };\n          // 调用创建会话接口\n          this.$store\n            .dispatch('jv/post', params)\n            .then(res => {\n              if (res) {\n                this.dialogId = res._jv.id;\n                this.getChatRecord(res._jv.id);\n              }\n            })\n            .catch(err => {\n              if (err && err.data && err.data.errors) {\n                if (err.data.errors[0].code === 'content_banned') {\n                  uni.showToast({\n                    icon: 'none',\n                    title: this.i18n.t('core.content_banned'),\n                    duration: 2000,\n                  });\n                }\n                if (err.data.errors[0].code === 'permission_denied') {\n                  uni.showToast({\n                    icon: 'none',\n                    title: this.i18n.t('core.permission_denied'),\n                    duration: 2000,\n                  });\n                }\n              }\n            });\n        } else {\n          const params = {\n            _jv: {\n              type: 'dialog/message',\n            },\n            dialog_id: this.dialogId,\n            message_text: this.msg,\n          };\n          // 调用发送消息接口\n          this.$store\n            .dispatch('jv/post', params)\n            .then(res => {\n              if (res) {\n                this.scrollToBottom();\n              }\n            })\n            .catch(err => {\n              if (err && err.data && err.data.errors) {\n                if (err.data.errors[0].code === 'content_banned') {\n                  uni.showToast({\n                    icon: 'none',\n                    title: this.i18n.t('core.content_banned'),\n                    duration: 2000,\n                  });\n                }\n                if (err.data.errors[0].code === 'permission_denied') {\n                  uni.showToast({\n                    icon: 'none',\n                    title: this.i18n.t('core.permission_denied'),\n                    duration: 2000,\n                  });\n                }\n              }\n            });\n        }\n        this.msg = '';\n        this.emojiShow = false;\n      }\n    },\n    // 弹出表情组件\n    popEmoji() {\n      if (this.emojiShow) {\n        this.scrollTop = this.old.scrollTop;\n        this.scrollToBottom();\n        this.bottomPadding -= 204;\n        // this.scrollTop = this.old.scrollTop;\n        // this.$nextTick(() => {\n        //   this.scrollTop -= 204;\n        // });\n      } else {\n        this.scrollTop = this.old.scrollTop;\n        this.scrollToBottom(true);\n        this.bottomPadding += 204;\n        this.$nextTick(() => {\n          this.scrollTop += 204;\n        });\n      }\n      this.emojiShow = !this.emojiShow;\n    },\n    // 获取表情\n    getEmojiClick(code) {\n      this.focus = this.old.focus;\n      let text = '';\n      text = `${this.msg.slice(0, this.cursor) + code + this.msg.slice(this.cursor)}`;\n      this.msg = text;\n      this.cursor += code.length;\n      this.$nextTick(() => {\n        this.focus = true;\n        uni.hideKeyboard();\n      });\n    },\n    jumpUserPage(id) {\n      if (id) {\n        uni.navigateTo({\n          url: `/pages/profile/index?userId=${id}`,\n        });\n      }\n    },\n  },\n};\n</script>\n\n<style lang=\"scss\" scoped>\n@import '@/styles/base/variable/global.scss';\n@import '@/styles/base/theme/fn.scss';\n\n.chat-box {\n  height: 100%;\n  margin: 0rpx 0rpx 140rpx;\n  background: --color(--qui-BG-ED);\n\n  &-wrap {\n    position: absolute;\n    top: 0rpx;\n    right: 0rpx;\n    bottom: 0rpx;\n    left: 0rpx;\n    margin: auto;\n    overflow: auto;\n  }\n\n  &__con {\n    font-size: $fg-f2;\n\n    &__time {\n      padding: 30rpx 0;\n      font-size: $fg-f1;\n      font-weight: 400;\n      color: --color(--qui-JT-B5);\n      text-align: center;\n    }\n\n    &__msg__mine {\n      display: flex;\n      flex-direction: row-reverse;\n      justify-content: flex-start;\n      align-items: center;\n\n      &__img {\n        margin: 0 20rpx 0 10rpx;\n      }\n\n      &__box {\n        position: relative;\n        max-width: 550rpx;\n        padding: 25rpx 20rpx;\n        margin-right: 20rpx;\n        color: --color(--qui-FC-34);\n        background: --color(--qui-BG-D1E0FF);\n        border: 1rpx solid --color(--qui-BG-A3CAFF);\n        border-radius: 10rpx;\n      }\n\n      &__box:before {\n        position: absolute;\n        top: 30rpx;\n        right: -18.6rpx;\n        z-index: 100;\n        width: 0rpx;\n        height: 0rpx;\n        border-top: 10rpx solid transparent;\n        border-right: 10rpx solid transparent;\n        border-bottom: 10rpx solid transparent;\n        border-left: 10rpx solid --color(--qui-BOR-D1E0FF);\n        content: '';\n      }\n\n      &__box:after {\n        position: absolute;\n        top: 30rpx;\n        right: -20rpx;\n        z-index: 99;\n        width: 0rpx;\n        height: 0rpx;\n        padding: 0;\n        border-top: 10rpx solid transparent;\n        border-right: 10rpx solid transparent;\n        border-bottom: 10rpx solid transparent;\n        border-left: 10rpx solid --color(--qui-BOR-A3CAFF);\n        content: '';\n      }\n    }\n\n    &__msg__other {\n      display: flex;\n      flex-direction: row;\n      justify-content: flex-start;\n      align-items: center;\n\n      &__img {\n        margin: 0 10rpx 0 20rpx;\n      }\n\n      &__box {\n        position: relative;\n        max-width: 550rpx;\n        padding: 25rpx 20rpx;\n        margin: 0rpx 0rpx 0rpx 20rpx;\n        background: --color(--qui-BG-2);\n        border: 1rpx solid --color(--qui-BOR-E5);\n        border-radius: 10rpx;\n      }\n\n      &__box:before {\n        position: absolute;\n        top: 30rpx;\n        left: -18.6rpx;\n        z-index: 100;\n        width: 0rpx;\n        height: 0rpx;\n        border-top: 10rpx solid transparent;\n        border-right: 10rpx solid --color(--qui-BOR-FFF);\n        border-bottom: 10rpx solid transparent;\n        border-left: 10rpx solid transparent;\n        content: '';\n      }\n\n      &__box:after {\n        position: absolute;\n        top: 30rpx;\n        left: -20rpx;\n        z-index: 99;\n        width: 0rpx;\n        height: 0rpx;\n        padding: 0;\n        border-top: 10rpx solid transparent;\n        border-right: 10rpx solid --color(--qui-BOR-CCC);\n        border-bottom: 10rpx solid transparent;\n        border-left: 10rpx solid transparent;\n        content: '';\n      }\n    }\n  }\n\n  &__footer {\n    position: fixed;\n    bottom: 0rpx;\n    z-index: 999;\n    width: 100%;\n    min-height: 140rpx;\n    background: --color(--qui-BG-BTN-GRAY-1);\n\n    &__msg {\n      display: flex;\n      flex-direction: row;\n      justify-content: space-between;\n      align-items: center;\n      padding: 20rpx 20rpx 40rpx;\n      background: --color(--qui-BG-BTN-GRAY-1);\n\n      &__icon {\n        margin: 0rpx 20rpx 0rpx 0rpx;\n      }\n    }\n\n    .uni-input {\n      width: 65%;\n      height: 80rpx;\n      padding: 0rpx 0rpx 0rpx 20rpx;\n      background: --color(--qui-BG-2);\n      border-radius: 5rpx;\n    }\n\n    &__btn {\n      margin: 0 0 0 10rpx;\n      font-size: $fg-f4;\n      background: --color(--qui-BG-BTN);\n    }\n  }\n}\n/deep/ .emoji-box {\n  width: calc(100vw - 40rpx);\n}\n</style>\n","import mod from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=style&index=0&id=b1f18fbe&lang=scss&scoped=true&\"; export default mod; export * from \"-!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\mini-css-extract-plugin\\\\dist\\\\loader.js??ref--8-oneOf-1-0!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\css-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-1!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\loaders\\\\stylePostLoader.js!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-2!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\postcss-loader\\\\src\\\\index.js??ref--8-oneOf-1-3!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\sass-loader\\\\dist\\\\cjs.js??ref--8-oneOf-1-4!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\webpack-preprocess-loader\\\\index.js??ref--8-oneOf-1-5!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\vue-cli-plugin-uni\\\\packages\\\\vue-loader\\\\lib\\\\index.js??vue-loader-options!G:\\\\HBuilderX\\\\plugins\\\\uniapp-cli\\\\node_modules\\\\@dcloudio\\\\webpack-uni-mp-loader\\\\lib\\\\style.js!./msglist.vue?vue&type=style&index=0&id=b1f18fbe&lang=scss&scoped=true&\"","// extracted by mini-css-extract-plugin\n    if(module.hot) {\n      // 1636533856241\n      var cssReload = require(\"G:/HBuilderX/plugins/uniapp-cli/node_modules/mini-css-extract-plugin/dist/hmr/hotModuleReplacement.js\")(module.id, {\"hmr\":true,\"publicPath\":\"../../\",\"locals\":false});\n      module.hot.dispose(cssReload);\n      module.hot.accept(undefined, cssReload);\n    }\n  "],"sourceRoot":""}