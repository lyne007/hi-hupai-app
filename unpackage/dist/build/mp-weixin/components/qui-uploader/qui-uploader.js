(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/qui-uploader/qui-uploader"],{"48e4":function(e,t,a){"use strict";var o=a("5fb4"),r=a.n(o);r.a},"5fb4":function(e,t,a){},"7fe4":function(e,t,a){"use strict";a.r(t);var o=a("b6a3"),r=a("9491");for(var n in r)"default"!==n&&function(e){a.d(t,e,(function(){return r[e]}))}(n);a("48e4");var i,u=a("f0c5"),s=Object(u["a"])(r["default"],o["b"],o["c"],!1,null,"7c7c26ba",null,!1,o["a"],i);t["default"]=s.exports},9491:function(e,t,a){"use strict";a.r(t);var o=a("f43f"),r=a.n(o);for(var n in o)"default"!==n&&function(e){a.d(t,e,(function(){return o[e]}))}(n);t["default"]=r.a},b6a3:function(e,t,a){"use strict";a.d(t,"b",(function(){return r})),a.d(t,"c",(function(){return n})),a.d(t,"a",(function(){return o}));var o={quiIcon:function(){return a.e("components/qui-icon/qui-icon").then(a.bind(null,"5d1d"))}},r=function(){var e=this,t=e.$createElement,a=(e._self._c,e.__map(e.uploadBeforeList,(function(t,a){var o=e.__get_orig(t),r=e.numberdata[a]&&e.numberdata[a].state<100?e.i18n.t("discuzq.image.imageUploading"):null;return{$orig:o,g0:r}})));e.$mp.data=Object.assign({},{$root:{l0:a}})},n=[]},f43f:function(e,t,a){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var o=n(a("a34a")),r=a("4b76");function n(e){return e&&e.__esModule?e:{default:e}}function i(e,t,a,o,r,n,i){try{var u=e[n](i),s=u.value}catch(d){return void a(d)}u.done?t(s):Promise.resolve(s).then(o,r)}function u(e){return function(){var t=this,a=arguments;return new Promise((function(o,r){var n=e.apply(t,a);function u(e){i(n,o,r,u,s,"next",e)}function s(e){i(n,o,r,u,s,"throw",e)}u(void 0)}))}}var s=0,d={name:"QuiUploader",props:{chooseType:{default:1,type:Number},url:{default:"",type:String},type:{default:"image",type:String},formData:{default:Object,type:Object},name:{default:"file",type:String},count:{default:9,type:[Number,String]},asyncClear:{default:!1,type:Boolean},filePreview:{type:Array,default:function(){return[]}},delayTime:{default:500,type:Number}},data:function(){return{uploadBeforeList:[],uploadList:[],uploadIndex:"",formDataAppend:{},lastOrder:0,numberdata:[],indexs:"",erroindex:"",number:0,detailindex:[],newindex:[],cunmumber:1,uploadType:"",header:{},dataCount:this.count,chooseLength:0,uploadCount:0}},watch:{formData:{handler:function(e){this.formData=e,this.uploadStatus=!0},deep:!0,immediate:!0}},created:function(){var e=this;return u(o.default.mark((function t(){return o.default.wrap((function(t){while(1)switch(t.prev=t.next){case 0:setTimeout((function(){e.uploadBeforeList=e.uploadBeforeList.concat(e.filePreview),e.uploadList.concat(e.filePreview).forEach((function(t){e.uploadList.push(t)})),e.uploadBeforeList.length>0&&e.uploadBeforeList.map((function(){return e.numberdata.push({state:100})}))}),e.delayTime),e.filePreview.length?e.lastOrder=e.filePreview[e.filePreview.length-1].order:e.lastOrder=0;case 2:case"end":return t.stop()}}),t)})))()},methods:{getValue:function(){return this.uploadList},uploadDelete:function(e){this.uploadList.sort(this.compare("order"));var t=this.uploadList[e];this.asyncClear?this.$emit("clear",t,e):(this.uploadBeforeList.splice(e,1),this.uploadList.splice(e,1),this.numberdata.splice(e,1),this.$emit("clear",this.uploadList,t))},clear:function(e){this.uploadList.sort(this.compare("order"));var t=this.uploadList[e];return this.uploadBeforeList.splice(e,1),this.numberdata.splice(e,1),t},previewPicture:function(t,a){for(var o=this,r=[],n=0,i=o.uploadBeforeList.length;n<i;n+=1)r.push(o.uploadBeforeList[n].path);e.previewImage({current:t,urls:r,indicator:"default"})},compare:function(e){return function(t,a){var o=t[e],r=a[e];return o-r}},uploadClick:function(){var t=this,a=t.uploadBeforeList.length;0===t.chooseType&&(t.uploadList=[],t.uploadBeforeList=[],t.dataCount=9,t.lastOrder=0,s=0),(t.uploadList.length<t.dataCount||"avatar"===t.name)&&wx.chooseImage({count:t.dataCount-t.uploadBeforeList.length,sizeType:["original","compressed"],sourceType:["album","camera"],success:function(o){t.chooseLength=o.tempFiles.length,e.$emit("uploadLength",t.chooseLength),t.$emit("uploadClick",!1),t.$emit("chooseSuccess");var r=o.tempFiles.map((function(e,r){return t.lastOrder+=1,new Promise((function(e,n){o.tempFiles[r].uploadPercent=0,o.tempFiles[r].uploadStatus=!1,t.uploadBeforeList.push(o.tempFiles[r]),t.numberdata.push({state:0}),t.newindex.push(o.tempFiles[r]),t.upload(o.tempFilePaths[r],t.uploadBeforeList.length-1,a,t.lastOrder,e,n)}))}));Promise.race(r).then((function(){if(t.uploadBeforeList.length>t.dataCount){var e=t.uploadList.slice(0,t.dataCount);t.uploadList.splice(0),e.forEach((function(e){t.uploadList.push(e)}))}t.$emit("change",t.uploadList,!0)}))}})},upload:function(t,a,n,i,d,l){var p=this,c=e.getStorageSync("access_token");p.header={authorization:"Bearer ".concat(c)},0===p.chooseType&&e.showLoading({title:p.i18n.t("core.loading"),mask:!0});var f={type:p.formData.type,order:i};p.formDataAppend={};var h=e.uploadFile({url:p.url,fileType:p.type,filePath:t,header:p.header,name:p.name,formData:f,success:function(t){if(!(t.statusCode>=200&&t.statusCode<300)){p.number+=1;var o=JSON.parse(t.data);if(o.errors[0].detail?e.showToast({icon:"none",title:"".concat(r.i18n.t("core.".concat(o.errors[0].code)),"\n").concat(o.errors[0].detail[0])}):e.showToast({icon:"none",title:o.errors[0].code}),p.uploadBeforeList.length>1)for(var n=0;n<p.uploadBeforeList.length;n+=1)p.uploadBeforeList[n]===p.newindex[a]&&(p.uploadBeforeList.splice(n,1),p.uploadList.splice(n,1),p.numberdata.splice(n,1),p.erroindex=n);else p.uploadBeforeList.splice(0,1),p.uploadList.splice(0,1),p.numberdata.splice(0,1);return a>0&&a===p.uploadBeforeList.length?p.indexs=a-1:a>0&&a<p.uploadBeforeList.length?p.indexs=a:a>0&&a>=p.uploadBeforeList.length?p.indexs=a-p.number:0===a&&(p.indexs=0),p.$emit("uploadFail",t,p.uploadList),l(t)}return setTimeout((function(){if(s+=1,0===p.chooseType&&a<=8&&e.$emit("uploadOver",{data:JSON.parse(t.data),times:s}),a<p.uploadBeforeList.length&&(p.uploadBeforeList[a].uploadPercent=100,p.uploadBeforeList[a].id=JSON.parse(t.data).data.id,p.numberdata[a].state=100),""!==p.erroindex&&p.erroindex>=0&&p.erroindex<p.uploadBeforeList.length&&(p.uploadBeforeList[p.erroindex].uploadPercent=100,p.numberdata[p.erroindex].state=100),p.indexs>=0&&""!==p.indexs&&p.indexs<p.uploadBeforeList.length&&(p.uploadBeforeList[p.indexs].uploadPercent=100,p.numberdata[p.indexs].state=100),p.uploadList.push(JSON.parse(t.data).data),p.uploadList.length>p.dataCount){p.uploadList.sort(p.compare("order")),p.uploadBeforeList=p.uploadBeforeList.slice(0,p.count);var o=p.uploadList.slice(0,p.dataCount);p.uploadList.splice(0),o.forEach((function(e){p.uploadList.push(e)})),p.numberdata=p.numberdata.slice(0,p.dataCount),p.newindex=p.newindex.slice(0,p.dataCount)}p.newindex=[],p.formDataAppend={}}),500),p.formDataAppend={},p.$emit("uploadSuccess",t,p.uploadList),d(p.uploadList)},fail:function(e){return p.uploadBeforeList.splice(a,1),p.uploadList.splice(a,1),p.numberdata.splice(a,1),p.$emit("uploadFail",e,p.uploadList),l(e)},complete:function(t){0===p.chooseType&&JSON.parse(t.data).errors&&JSON.parse(t.data).errors.length>0&&(p.chooseLength=p.chooseLength>p.dataCount?p.dataCount:p.chooseLength,e.$emit("uploadFail",{data:JSON.parse(t.data)}))}});h.onProgressUpdate(function(){var e=u(o.default.mark((function e(t){var a,r;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:return e.next=2,t.progress;case 2:for(a=e.sent,r=n;r<p.uploadBeforeList.length;r+=1)a<100?(p.uploadBeforeList[r].uploadPercent=a,p.numberdata[r]&&(p.numberdata[r].state=p.uploadBeforeList[r].uploadPercent)):100===a&&(p.uploadBeforeList[r].uploadPercent=90,p.numberdata[r]&&(p.numberdata[r].state=p.uploadBeforeList[r].uploadPercent));case 4:case"end":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}())}}};t.default=d}).call(this,a("543d")["default"])}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/qui-uploader/qui-uploader-create-component',
    {
        'components/qui-uploader/qui-uploader-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("7fe4"))
        })
    },
    [['components/qui-uploader/qui-uploader-create-component']]
]);
