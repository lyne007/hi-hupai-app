(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["components/qui-upload-audio/qui-upload-audio"],{"0303":function(t,n,i){"use strict";Object.defineProperty(n,"__esModule",{value:!0}),n.default=void 0;var e=u(i("5303")),o=u(i("209b"));function u(t){return t&&t.__esModule?t:{default:t}}var a=wx.getRecorderManager(),r={props:{audioBeforeList:{type:Array,default:function(){return[]}}},data:function(){return{fileList:[],showAdd:!0,duration:"00:00:00",durationTime:0,timer:null,recorder:new e.default,isUpLoad:!0,uploadLoading:!1}},computed:{userId:function(){return this.$store.getters["session/get"]("userId")}},watch:{audioBeforeList:{handler:function(t){this.fileList=t,this.$emit("change",this.fileList)},deep:!0,immediate:!0},durationTime:{handler:function(t){60===t&&this.stop()},deep:!0}},methods:{start:function(){var t=this,n={sampleRate:16e3,numberOfChannels:1,encodeBitRate:96e3,format:"mp3",frameSize:50};a.start(n),a.onStart((function(){t.showAdd=!1,t.chronoscope()})),a.onError((function(t){console.log(t)}))},stop:function(){var t=this;if(this.durationTime>1&&(clearInterval(this.timer),this.isUpLoad)){this.uploadLoading=!0,this.isUpLoad=!1;var n="".concat(this.userId,"_").concat(this.getCurrentTime(),".mp3");a.stop(),a.onStop((function(i){t.uploadAudio(i,n)}))}},uploadAudio:function(t,n){var i=this;o.default.start({mediaFile:t,getSignature:i.getSignature,mediaName:n,success:function(){},error:function(){i.$refs.toast.show({message:i.i18n.t("uploader.uploadFailed")})},progress:function(){},finish:function(t){i.postVideo(t.fileId,1,t.videoUrl,n)}})},getSignature:function(t){this.$store.dispatch("jv/get",["signature",{}]).then((function(n){t(n.signature)}))},showNum:function(t){return t<10?"0".concat(t):t},getCurrentTime:function(){var t=new Date,n=t.getFullYear(),i=this.showNum(t.getMonth()+1),e=this.showNum(t.getDate()),o=this.showNum(t.getHours()),u=this.showNum(t.getMinutes()),a=this.showNum(t.getSeconds());return"".concat(n).concat(i).concat(e).concat(o).concat(u).concat(a)},chronoscope:function(){var t=this;clearInterval(this.timer),this.timer=setInterval((function(){t.durationTime+=1;var n=t.showNum(parseInt(t.durationTime/60/60,10)),i=t.showNum(parseInt(t.durationTime/60,10)%60),e=t.showNum(t.durationTime%60);t.duration="".concat(n,":").concat(i,":").concat(e)}),1e3)},deleteItem:function(){this.$emit("audioDel")},blobToFile:function(t,n){return t.lastModifiedDate=new Date,t.name=n,t},audioPlayer:function(){var t=this;this.fileList.forEach((function(n){t.$refs["audio".concat(n.id)][0].audioPause()}))},postVideo:function(t,n,i,e){var o=this,u={_jv:{type:"thread/video"},file_id:t,media_url:i,type:n};this.$store.dispatch("jv/post",u).then((function(t){o.duration="00:00:00",o.durationTime=0,o.timer=null,o.uploadLoading=!1,o.isUpLoad=!0,o.fileList.push({fileName:e,url:t.media_url,id:t.file_id}),o.showAdd=!0}))}}};n.default=r},"3d62":function(t,n,i){"use strict";i.r(n);var e=i("cd2a"),o=i("c821");for(var u in o)"default"!==u&&function(t){i.d(n,t,(function(){return o[t]}))}(u);i("a496");var a,r=i("f0c5"),s=Object(r["a"])(o["default"],e["b"],e["c"],!1,null,"3ee290e6",null,!1,e["a"],a);n["default"]=s.exports},a464:function(t,n,i){},a496:function(t,n,i){"use strict";var e=i("a464"),o=i.n(e);o.a},c821:function(t,n,i){"use strict";i.r(n);var e=i("0303"),o=i.n(e);for(var u in e)"default"!==u&&function(t){i.d(n,t,(function(){return e[t]}))}(u);n["default"]=o.a},cd2a:function(t,n,i){"use strict";i.d(n,"b",(function(){return o})),i.d(n,"c",(function(){return u})),i.d(n,"a",(function(){return e}));var e={quiAudioCell:function(){return i.e("components/qui-audio-cell/qui-audio-cell").then(i.bind(null,"7889"))},quiIcon:function(){return i.e("components/qui-icon/qui-icon").then(i.bind(null,"5d1d"))},quiToast:function(){return i.e("components/qui-toast/qui-toast").then(i.bind(null,"6512"))},quiLoading:function(){return i.e("components/qui-loading/qui-loading").then(i.bind(null,"04b4"))}},o=function(){var t=this,n=t.$createElement,i=(t._self._c,t.fileList.length>0||t.showAdd?null:t.i18n.t("discuzq.post.recording")),e=t.fileList.length>0||t.showAdd?null:t.i18n.t("discuzq.post.finish"),o=t.uploadLoading?t.i18n.t("discuzq.post.uploading"):null;t.$mp.data=Object.assign({},{$root:{g0:i,g1:e,g2:o}})},u=[]}}]);
;(global["webpackJsonp"] = global["webpackJsonp"] || []).push([
    'components/qui-upload-audio/qui-upload-audio-create-component',
    {
        'components/qui-upload-audio/qui-upload-audio-create-component':(function(module, exports, __webpack_require__){
            __webpack_require__('543d')['createComponent'](__webpack_require__("3d62"))
        })
    },
    [['components/qui-upload-audio/qui-upload-audio-create-component']]
]);
