(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["topic/post"],{2662:function(t,e,s){"use strict";s.r(e);var i=s("49eb"),o=s("af8f");for(var a in o)"default"!==a&&function(t){s.d(e,t,(function(){return o[t]}))}(a);s("7169");var n,r=s("f0c5"),c=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,"e90aefc2",null,!1,i["a"],n);e["default"]=c.exports},"49eb":function(t,e,s){"use strict";s.d(e,"b",(function(){return o})),s.d(e,"c",(function(){return a})),s.d(e,"a",(function(){return i}));var i={quiPage:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-page/qui-page")]).then(s.bind(null,"2bf0"))},quiCellItem:function(){return s.e("components/qui-cell-item/qui-cell-item").then(s.bind(null,"bd3e"))},quiAvatar:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-avatar/qui-avatar")]).then(s.bind(null,"ce3f"))},quiIcon:function(){return s.e("components/qui-icon/qui-icon").then(s.bind(null,"5d1d"))},quiEmoji:function(){return s.e("components/qui-emoji/qui-emoji").then(s.bind(null,"aa0f"))},quiUploader:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-uploader/qui-uploader")]).then(s.bind(null,"7fe4"))},quiUploadFile:function(){return s.e("components/qui-upload-file/qui-upload-file").then(s.bind(null,"da15"))},quiUploadVideo:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-upload-video/qui-upload-video")]).then(s.bind(null,"2867"))},quiUploadAudio:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-upload-audio/qui-upload-audio")]).then(s.bind(null,"3d62"))},uSwitch:function(){return s.e("components/u-switch/u-switch").then(s.bind(null,"4a39"))},quiButton:function(){return s.e("components/qui-button/qui-button").then(s.bind(null,"a67c"))},quiPay:function(){return Promise.all([s.e("common/vendor"),s.e("components/qui-pay/qui-pay")]).then(s.bind(null,"1802"))},uniPopup:function(){return s.e("components/uni-popup/uni-popup").then(s.bind(null,"f1be"))},quiToast:function(){return s.e("components/qui-toast/qui-toast").then(s.bind(null,"6512"))},quiLoadingCover:function(){return s.e("components/qui-loading-cover/qui-loading-cover").then(s.bind(null,"8633"))}},o=function(){var t=this,e=t.$createElement,s=(t._self._c,t.loadStatus&&1===t.type&&1===t.type?t.i18n.t("discuzq.post.pleaseEnterAPostTitle"):null),i=t.loadStatus&&5===t.type&&5===t.type?t.i18n.t("discuzq.post.askedUsers"):null,o=t.loadStatus&&5!==t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null,a=!t.loadStatus||5===t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),n=t.loadStatus&&5===t.type&&t.textAreaValue.length<=t.textAreaLength?t.i18n.t("discuzq.post.note",{num:t.textAreaLength-t.textAreaValue.length}):null,r=!t.loadStatus||5!==t.type||t.textAreaValue.length<=t.textAreaLength?null:t.i18n.t("discuzq.post.exceed",{num:t.textAreaValue.length-t.textAreaLength}),c=t.loadStatus&&5!==t.type?t.i18n.t("discuzq.post.placeholder"):null,u=t.loadStatus&&5===t.type?t.i18n.t("discuzq.post.placeholderQuestion"):null,d=t.loadStatus&&1===t.type&&t.forums.other&&t.forums.other.can_create_thread_paid&&t.ioshide?t.i18n.t("discuzq.post.lookPay"):null,h=t.loadStatus&&1===t.type&&0!==t.type&&t.showHidden&&t.forums.paycenter&&t.forums.paycenter.wxpay_close&&0!==t.payType&&t.forums.other.can_create_thread_paid&&t.ioshide?t.i18n.t("discuzq.post.paymentAmount"):null,p=t.loadStatus&&1!==t.type&&0!==t.type&&5!==t.type&&6!==t.type&&t.forums.other.can_create_thread_paid&&t.ioshide&&0!==t.type&&t.showHidden&&t.forums.paycenter.wxpay_close&&t.forums.other.can_create_thread_paid&&t.ioshide&&4===t.type?t.i18n.t("discuzq.post.payByListeningToAudio"):null,l=t.loadStatus&&1!==t.type&&0!==t.type&&5!==t.type&&6!==t.type&&t.forums.other.can_create_thread_paid&&t.ioshide&&0!==t.type&&t.showHidden&&t.forums.paycenter.wxpay_close&&t.forums.other.can_create_thread_paid&&t.ioshide&&4!==t.type?t.i18n.t("discuzq.post.paymentAmount"):null,f=t.loadStatus&&5===t.type?t.i18n.t("discuzq.post.anonymousQuestions"):null,m=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.otherPay"):null,y=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.youHaveTo"):null,g=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.yuan"):null,v=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.theAnswerIs"):null,_=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.yuan"):null,w=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.platform"):null,S=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_be_onlooker?t.i18n.t("discuzq.post.yuan"):null,b=t.loadStatus&&t.price>0&&3!==t.type&&2!==t.type&&0!==t.type&&4!==t.type&&5!==t.type&&1!==t.payType&&0!==t.payType?t.i18n.t("discuzq.post.freeWordCount"):null,T=t.loadStatus&&t.price>0&&3!==t.type&&2!==t.type&&0!==t.type&&4!==t.type&&5!==t.type&&1!==t.payType&&0!==t.payType?t.i18n.t("discuzq.post.word",{num:t.percentagedisplay}):null,k=!(t.loadStatus&&t.forums.lbs&&t.forums.lbs.lbs)||t.currentPosition&&t.currentPosition.location?null:t.i18n.t("discuzq.post.addPosition"),P=t.loadStatus?t.i18n.t("discuzq.post.chooseCategory"):null,I=Number(t.categoryId),x=Number(t.categoryId),A=Number(t.categoryId),q=t.loadStatus?t.__map(t.allCategories,(function(e,s){var i=t.__get_orig(e),o=Number(e._jv.id),a=Number(e._jv.id),n=Number(e._jv.id);return{$orig:i,m0:o,m2:a,m4:n}})):null,C=t.loadStatus&&(5!==t.type||5===t.type&&t.forums.other&&!1===t.forums.other.can_create_thread_paid)?t.i18n.t("discuzq.post.post"):null,j=t.loadStatus&&5===t.type&&t.forums.other&&t.forums.other.can_create_thread_paid?t.i18n.t("discuzq.post.nextPay"):null,$=t.loadStatus&&t.payShowStatus?Number(t.user.walletBalance):null,z=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):null,L=t.loadStatus&&1===t.type&&t.canUploadAttachment?t.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"):null,N=t.loadStatus?t.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"):null,V=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,B=t.loadStatus&&5!==t.type&&"pay"===t.setType?t.i18n.t("discuzq.post.selectToViewPaymentAmount"):null,F=t.loadStatus&&5!==t.type&&"pay"!==t.setType?t.i18n.t("discuzq.post.selectToViewFreeWordCount"):null,O=t.loadStatus&&"pay"===t.setType&&5===t.type?t.i18n.t("discuzq.post.supportTheAuthorToContinueToCreate"):null,E=t.loadStatus?t.i18n.t("discuzq.post.cancel"):null,G=t.loadStatus&&t.popupStatus&&"pay"===t.setType?t.i18n.t("discuzq.post.enterToViewPaymentAmount"):null,D=t.loadStatus&&t.popupStatus&&"pay"!==t.setType?t.i18n.t("discuzq.post.enterTheWordCount"):null,U=t.loadStatus&&t.popupStatus&&"pay"!==t.setType?t.i18n.t("discuzq.post.word",{num:""}):null,R=t.loadStatus&&t.popupStatus?t.i18n.t("discuzq.close"):null,M=t.loadStatus&&t.popupStatus&&"pay"===t.setType?t.i18n.t("discuzq.ok"):null,W=t.loadStatus&&t.popupStatus&&"pay"!==t.setType?t.i18n.t("discuzq.ok"):null;t.$mp.data=Object.assign({},{$root:{g0:s,g1:i,g2:o,g3:a,g4:n,g5:r,g6:c,g7:u,g8:d,g9:h,g10:p,g11:l,g12:f,g13:m,g14:y,g15:g,g16:v,g17:_,g18:w,g19:S,g20:b,g21:T,g22:k,g23:P,m1:I,m3:x,m5:A,l0:q,g24:C,g25:j,m6:$,g26:z,g27:L,g28:N,g29:V,g30:B,g31:F,g32:O,g33:E,g34:G,g35:D,g36:U,g37:R,g38:M,g39:W}})},a=[]},7169:function(t,e,s){"use strict";var i=s("9100"),o=s.n(i);o.a},9100:function(t,e,s){},af8f:function(t,e,s){"use strict";s.r(e);var i=s("ea1a"),o=s.n(i);for(var a in i)"default"!==a&&function(t){s.d(e,t,(function(){return i[t]}))}(a);e["default"]=o.a},d497:function(t,e,s){"use strict";(function(t){s("3768");i(s("66fd"));var e=i(s("2662"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,s("543d")["createPage"])},ea1a:function(t,e,s){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i,o=d(s("a34a")),a=s("2f62"),n=s("0301"),r=d(s("8605")),c=d(s("245a")),u=d(s("412c"));function d(t){return t&&t.__esModule?t:{default:t}}function h(t,e,s,i,o,a,n){try{var r=t[a](n),c=r.value}catch(u){return void s(u)}r.done?e(c):Promise.resolve(c).then(i,o)}function p(t){return function(){var e=this,s=arguments;return new Promise((function(i,o){var a=t.apply(e,s);function n(t){h(a,i,o,n,r,"next",t)}function r(t){h(a,i,o,n,r,"throw",t)}n(void 0)}))}}function l(t,e){var s=Object.keys(t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);e&&(i=i.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),s.push.apply(s,i)}return s}function f(t){for(var e=1;e<arguments.length;e++){var s=null!=arguments[e]?arguments[e]:{};e%2?l(Object(s),!0).forEach((function(e){m(t,e,s[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(s)):l(Object(s)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(s,e))}))}return t}function m(t,e,s){return e in t?Object.defineProperty(t,e,{value:s,enumerable:!0,configurable:!0,writable:!0}):t[e]=s,t}var y=function(){s.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(s("8b8a"))}.bind(null,s)).catch(s.oe)},g=null,v=null,_={name:"Post",components:{uniPopupDialog:y},mixins:[r.default,c.default,u.default],data:function(){return{vditor:null,navTitle:"发布",loadStatus:"",textAreaValue:"",markdownShow:!1,barStatus:!1,textAreaLength:5e3,textAnswerLength:49999,postTitle:"",checkClassData:[],type:0,price:0,priceAsk:0,pwdVal:"",browser:0,inputPrice:"",maxLength:7,inputWord:"",operating:"",emojiShow:!1,textShow:!0,header:{},formData:{},captcha:null,captcha_ticket:"",captcha_rand_str:"",userImage:"",beUserName:"",checked:!1,watchChecked:!1,watchShow:!1,payShowStatus:!0,haveDate:0,answerIsDate:0,platformDate:0,askingPrice:!0,payNum:[{name:this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"),pay:0},{name:"￥2",pay:2},{name:"￥5",pay:5},{name:"￥10",pay:10},{name:"￥20",pay:20},{name:"￥50",pay:50},{name:"￥88",pay:88},{name:"￥128",pay:128},{name:this.i18n.t("discuzq.post.customize"),pay:0}],payNumCheck:[{name:"",pay:0}],freepercentage:[{name:"0%",pay:0},{name:"10%",pay:.1},{name:"30%",pay:.3},{name:"50%",pay:.5},{name:"70%",pay:.7},{name:"100%",pay:1}],freewords:[],percentagedisplay:"0%",uploadFile:[],cursor:0,wordCountCheck:[{name:this.i18n.t("discuzq.post.word",{num:0}),num:0}],word:0,setType:"pay",controlsStatus:!1,videoBeforeList:[],audioBeforeList:[],fullscreenStatus:!1,videoName:"",percent:0,fileId:"",url:"",postLoading:!1,allCategories:[],categoryIndex:"",categoryId:"",threadId:"",firstPostId:"",postDetails:{},filePreview:[],uploadStatus:!0,showHidden:!0,ticket:"",randstr:"",captchaResult:{},attachmentList:[],signatureVal:"",deleteType:"",deleteId:"",deleteIndex:"",deleteTip:"确定删除吗？",wechatTip:this.i18n.t("discuzq.wechatBind"),currentPosition:{},watchMoeny:"1",beAskId:"",payTypeText:"",orderSn:"",coverLoading:!1,payStatus:!1,payTypeData:[{name:"微信支付",icon:"icon-wxPay",color:"#09bb07",value:"0"},{name:"钱包支付",icon:"icon-walletPay",color:"#1878f3",value:"1"}],chooseType:1,payType:0,showPayType:"",ioshide:!1,isShowGoods:!0,dataGoodInfo:{},dataGoodInfoPrice:0,goodsId:"",categoryid:0,categoryindex:0,postShow:!1,popupStatus:!1,canUploadAttachment:!1}},computed:f(f({},(0,a.mapState)({getAtMemberData:function(t){return t.atMember.atMemberData}})),{},{showPrice:function(){var t="";return t=1===this.type?this.i18n.t("discuzq.post.pleaseChoice"):this.i18n.t("discuzq.post.free"),t=this.price<=0?1===this.type?this.i18n.t("discuzq.post.pleaseChoice"):this.i18n.t("discuzq.post.free"):"￥".concat(this.price+this.i18n.t("discuzq.post.yuan")),t},showAskPrice:function(){var t=this.i18n.t("discuzq.post.free");return t=this.priceAsk<=0?this.i18n.t("discuzq.post.free"):"￥".concat(this.priceAsk+this.i18n.t("discuzq.post.yuan")),t},currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)}}),updated:function(){var e=this;this.forums&&5===this.type&&(this.platformDate=(this.forums.set_site.site_onlooker_price*(this.forums.set_site.site_master_scale/10)).toFixed(2),this.haveDate=((this.forums.set_site.site_onlooker_price-this.platformDate)/2).toFixed(2),this.answerIsDate=(this.forums.set_site.site_onlooker_price-this.platformDate-this.haveDate).toFixed(2)),t.$on("uploadVideoOver",(function(t){e.percent=1,t.doneResult&&(e.fileId=t.doneResult.fileId),t.result&&(e.fileId=t.result.fileId)}))},methods:f(f({addGoods:function(){"edit"===this.operating?t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type,"&operating=edit&threadId=").concat(this.threadId)}):t.redirectTo({url:"/pages/topic/parse-goods?type=".concat(this.type)})},deleteGoods:function(){this.dataGoodInfo=[],this.isShowGoods=!1},changeCheck:function(){},choosePosition:function(){var e=this;e.currentPosition.location||t.getSetting({success:function(s){s.authSetting["scope.userLocation"]?t.chooseLocation({success:function(t){var s=t;s.location=t.name,e.currentPosition=s}}):t.authorize({scope:"scope.userLocation",success:function(){t.chooseLocation({success:function(t){var s=t;s.location=t.name,e.currentPosition=s}})}})}})},clearPosition:function(){this.currentPosition={}},saveThread:function(){var e=this;t.removeStorageSync("current_thread"),1===this.type&&(this.textAreaValue=this.vditor.getValue());var s={},i=["postTitle","price","word","fileId","videoName","textAreaValue","categoryIndex","categoryId","checkClassData","uploadFile","videoBeforeList","audioBeforeList","checked","watchChecked","askingPrice","watchShow","priceAsk","beAskId","userImage","beUserName","type","showHidden","payType","showPayType","ioshide","dataGoodInfo"];if(i.forEach((function(t){e[t]&&(s[t]=e[t])})),this.$refs.uploadFiles){var o=this.$refs.uploadFiles.getValue(),a=[];o.forEach((function(t){a.push({fileName:t.attributes.fileName,url:t.attributes.url,_jv:{id:t.id}})})),s.attachmentList=a}if(this.$refs.upload){var n=this.$refs.upload.getValue();n.forEach((function(t,e){t.attributes&&(n[e]={path:t.attributes.thumbUrl,id:t.id,order:t.attributes.order,name:t.attributes.fileName,url:t.attributes.url})})),s.imgList=n}t.setStorageSync("current_thread",JSON.stringify(s))},setThread:function(){var e=this,s=t.getStorageSync("current_thread");s&&(s=JSON.parse(s),this.dataGoodInfo=s.dataGoodInfo,Object.getOwnPropertyNames(s).forEach((function(t){if("imgList"===t){var i=s[t];i.forEach((function(t,e){i[e]={thumbUrl:t.path,_jv:{id:t.id},order:t.order,fileName:t.name,url:t.url}}));var o={firstPost:{images:[]}};o.firstPost.images=s[t],e.setAnnex("img",o)}else e[t]=s[t]})),this.videoBeforeList.length>0&&(this.percent=1),t.removeStorageSync("current_thread"))},focusEvent:function(){},toolBarClick:function(t){var e="";"bold"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"**粗体文字**").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=2,this.focusEvent(this.cursor)):"italic"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"__").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"title"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"\n### ").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=4,this.focusEvent(this.cursor)):"quote"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"\n> ").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"link"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"[](url)").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"code"===t?(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"``").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=1,this.focusEvent(this.cursor)):"strikethrough"===t&&(e="".concat("".concat(this.textAreaValue.slice(0,this.cursor),"~~~~").concat(this.textAreaValue.slice(this.cursor))),this.cursor+=2,this.focusEvent(this.cursor)),this.textAreaValue=e}},(0,a.mapMutations)({setAtMember:"atMember/SET_ATMEMBER"})),{},(i={checkNum:function(e){var s=this,i=e.target.value,o=i.indexOf(".");i.indexOf(".")<0&&""!=i?i.length>6?(i=i.substring(0,i.length-1),t.showToast({title:s.c.TheAmountCannotExceedOneMillion,icon:"none"})):i=parseFloat(i):0==i.indexOf(".")?(i=i.replace(/[^$#$]/g,"0."),i=i.replace(/\.{2,}/g,".")):/^(\d?)+(\.\d{0,2})?$/.test(i)||(i=i.substring(0,i.length-1)),s.$nextTick((function(){s.maxLength=-1==o?7:10,s.inputPrice=i}))},videoDel:function(){this.deleteType=2,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteVideoSure")},playVideo:function(t){},fullscreenchange:function(t){this.fullscreenStatus=t.detail.fullScreen,t.detail.fullScreen||(this.controlsStatus=!1,this.videoContext.pause())},emojiclick:function(){this.emojiShow=!this.emojiShow,this.textShow=!this.textShow},contBlur:function(t){this.cursor=t.detail.cursor},diaLogClose:function(){this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0},diaLogOk:function(){if(""===this.forums.set_site.site_minimum_amount){if(this.inputPrice<"0.1")return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanOneYuan"),icon:"none"})}else if(this.inputPrice<this.forums.set_site.site_minimum_amount)return void t.showToast({title:this.i18n.t("core.TheAmountCannotBeLessThanMinMoney")+this.forums.set_site.site_minimum_amount+this.i18n.t("discuzq.post.yuan"),icon:"none"});if(5===this.type)return this.priceAsk=this.inputPrice,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0,void this.postClick();"pay"===this.setType?this.price=this.inputPrice:this.word=this.inputWord,this.$refs.popup.close(),this.popupStatus=!1,this.textShow=!0},percentageClick:function(t){this.word=this.freepercentage[t].pay,this.percentagedisplay=this.freepercentage[t].name,this.setType="word",this.freewords=[],this.freewords.push(this.freepercentage[t]),this.$refs.popupBtm.close()},moneyClick:function(t){var e=this;if(0===this.forums.set_site.site_onlooker_price&&(this.watchShow=!1),0===t){if(5===this.type)return this.postClick(),void(this.watchShow=!1);1!==this.type&&5!==this.type&&(this.payType=0,0===this.payType&&(this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree")))}else this.watchShow=!0;if(this.setType="pay",this.payNumCheck=[],this.payNumCheck.push(this.payNum[t]),console.log(this.payNum),this.payNumCheck[0].name===this.i18n.t("discuzq.post.customize"))console.log("自定义金额"),this.textShow=!1,this.$refs.popupBtm.close(),this.popupStatus=!0,this.$nextTick((function(){e.inputPrice="",e.$refs.popup.open(),e.textShow=!1}));else{if(5===this.type&&0!==t)return this.priceAsk=this.payNumCheck[0].pay,this.$refs.popupBtm.close(),this.postClick(),void(this.textShow=!0);this.price=this.payNumCheck[0].pay,this.$refs.popupBtm.close(),this.textShow=!0}},lookPay:function(){this.$refs.lookPayPopup.open()},cancelLookPay:function(){this.$refs.lookPayPopup.close()},choicePayType:function(t){0===t?(this.payNumCheck=[],this.price="",this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree")):1===t?(this.payNumCheck=[],this.showPayType=this.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"),this.payNum[0].name="￥1",this.payNum[0].pay=1):(this.payNumCheck=[],this.payNum[0].name="￥1",this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"),this.payNum[0].pay=1),this.payType=t,this.$refs.lookPayPopup.close()},cellClick:function(t){this.setType=t,this.$refs.popupBtm.open(),this.textShow=!1},postAnswerClick:function(t){this.$refs.popupBtm.open(),this.textShow=!1},cancel:function(){this.$refs.popupBtm.close(),this.textShow=!0},uploadClick:function(t){this.uploadStatus=t},uploadChange:function(t,e){this.uploadFile=t,this.uploadStatus=e},uploadClear:function(t,e){var s=t.id;this.deleteType=0,this.deleteId=s,this.deleteIndex=e,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteImgSure")},uploadAudioChange:function(t){this.audioBeforeList=t},audioDel:function(){this.deleteType=3,this.$refs.deletePopup.open(),this.deleteTip=this.i18n.t("core.deleteAudioSure")},getEmojiClick:function(t){var e="";e="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.cursor=e.length,this.textAreaValue=e,this.emojiShow=!1,this.textShow=!0},callClick:function(){t.navigateTo({url:"/pages/user/at-member"})},topicPage:function(){t.navigateTo({url:"/pages/topic/topic"})},checkClass:function(t,e){this.categoryIndex=e,this.categoryId=t._jv.id,this.checkClassData=[],this.checkClassData.push(this.allCategories[e])},payClickShow:function(){var t=this;if(console.log("payClickshow"),this.$store.getters["session/get"]("isLogin")||this.mpLoginMode(),this.payStatus=!1,this.forums.paycenter.wxpay_close){if(!this.forums.paycenter.wxpay_close||!this.forums.other.can_create_thread_paid)return this.ioshide=!1,void(this.payShowStatus=!1);if("ios"===this.system)return this.postShow=!0,this.payShowStatus=!1,void(this.ioshide=!1);this.ioshide=!0,this.payShowStatus=!0,this.payTypeText=this.t.pay+this.t.payAskingPrice,this.priceAsk=parseFloat(this.thread.price),this.$nextTick((function(){t.$refs.payShow.payClickShow(t.payTypeVal)}))}else this.payShowStatus=!1},paysureShow:function(e){if(t.setStorage({key:"page",data:"/topic/post?type=5&categoryId=".concat(this.categoryid,"&categoryIndex=").concat(this.categoryindex)}),0===e){if(void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid)return void this.$refs.wechatPopup.open();this.creatOrder(this.priceAsk,5,"",e)}},onInput:function(t){this.value=t,this.creatOrder(this.priceAsk,5,t,1)},creatOrder:function(t,e,s,i){var o=this,a={_jv:{type:"orders"},type:e,payee_id:this.beAskId,amount:t,is_anonymous:this.checked?"0":"1"};this.$store.dispatch("jv/post",a).then((function(t){o.orderSn=t.order_sn,0===i?0==o.browser?o.orderPay(13,s,o.orderSn,i,"0"):o.isWeixin&&o.isPhone?o.orderPay(12,s,o.orderSn,i,"1"):o.isPhone?o.orderPay(20,s,o.orderSn,1,"2"):o.orderPay(10,s,o.orderSn,i,"3"):1===i&&o.orderPay(20,s,o.orderSn,i)})).catch((function(t){console.log(t)}))},orderPay:function(e,s,i,o,a){var n=this,r={};0===o?r={_jv:{type:"trade/pay/order/".concat(i)},payment_type:e}:1===o&&(r={_jv:{type:"trade/pay/order/".concat(i)},payment_type:e,pay_password:s}),this.$store.dispatch("jv/post",r).then((function(e){n.wxRes=e,0===o?"0"===a?n.wechatPay(e.wechat_js.timeStamp,e.wechat_js.nonceStr,e.wechat_js.package,e.wechat_js.signType,e.wechat_js.paySign):"1"===a?"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",n.onBridgeReady(e),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",n.onBridgeReady(e)),document.attachEvent("onWeixinJSBridgeReady",n.onBridgeReady(e))):n.onBridgeReady(e):"2"===a?n.postThread().then((function(s){n.postLoading=!1,t.hideLoading(),e&&e.isApproved,e&&e._jv&&e._jv.json.data.id&&t.redirectTo({url:"/topic/index?id=".concat(e._jv.json.data.id)})})):"3"===a&&e&&(n.codeUrl=e.wechat_qrcode,n.payShowStatus=!1,n.$refs.codePopup.open(),n.qrcodeShow=!0,g=setInterval((function(){1!==n.payStatus?(n.getOrderStatus(n.orderSn,a),t.hideLoading()):clearInterval(g)}),3e3)):1===o&&("success"===e.wallet_pay.result&&(n.$store.dispatch("jv/get",["users/".concat(n.currentLoginId),{}]),n.coverLoading=!1,n.postThread().then((function(e){n.postLoading=!1,t.hideLoading(),e&&e.isApproved,e&&e._jv.json.data.id&&t.redirectTo({url:"/topic/index?id=".concat(e._jv.json.data.id)})}))),n.coverLoading=!1)})).catch((function(t){console.log(t),n.$refs.payShow.clearPassword()}))},getOrderStatus:function(e,s){var i=this;this.$store.dispatch("jv/get",["orders/".concat(e),{custom:{loading:!1}}]).then((function(e){i.payStatus=e.status,1===i.payStatus&&("2"===s||("3"===s?(i.$refs.codePopup.close(),i.qrcodeShow=!1,i.postThread()):("0"===s||"1"===s)&&i.postThread().then((function(e){i.postLoading=!1,t.hideLoading(),e&&e.isApproved,e&&e._jv.json.data.id&&t.redirectTo({url:"/topic/index?id=".concat(e._jv.json.data.id)})}))),i.$refs.toast.show({message:i.i18n.t("pay.paySuccess")}))})).catch((function(t){console.log(t),i.coverLoading=!1,i.$refs.toast.show({message:i.i18n.t("pay.payFail")})}))},wechatPay:function(e,s,i,o,a){var n=this;t.requestPayment({provider:"wxpay",timeStamp:e,nonceStr:s,package:i,signType:o,paySign:a,success:function(t){n.coverLoading=!0,g=setInterval((function(){1!==n.payStatus?n.getOrderStatus(n.orderSn,"0"):clearInterval(g)}),3e3)},fail:function(t){n.payShowStatus=!1,n.coverLoading=!1,n.$refs.toast.show({message:n.p.payFail})}})},onBridgeReady:function(t){var e=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:t.wechat_js.appId,timeStamp:t.wechat_js.timeStamp,nonceStr:t.wechat_js.nonceStr,package:t.wechat_js.package,signType:"MD5",paySign:t.wechat_js.paySign},(function(t){"get_brand_wcpay_request:ok"==t.err_msg||("get_brand_wcpay_request:cancel"==t.err_msg||"get_brand_wcpay_request:fail"==t.err_msg)&&(clearInterval(g),resolve)})),g=setInterval((function(){1!==e.payStatus?e.getOrderStatus(e.orderSn,"1"):clearInterval(g)}),3e3)},radioChange:function(t){},postClick:function(){var e=this;if(this.payTypeText=this.i18n.t("topic.pay")+this.i18n.t("discuzq.post.payAskingPrice"),!this.categoryId)return this.$refs.toast.show({message:this.i18n.t("discuzq.post.theclassifyCanNotBeBlank")}),!1;var s=!0;switch(this.type){case 0:this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),s=!1):s=!0;break;case 1:this.postTitle.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theTitleCanNotBeBlank")}),s=!1):this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),s=!1):this.uploadStatus?1===this.payType?0===this.$refs.uploadFiles.getValue().length?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.attachmentCannotBeEmpty")}),s=!1):0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),s=!1):s=!0:2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),s=!1):s=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),s=!1);break;case 2:this.videoBeforeList.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.videoCannotBeEmpty")}),s=!1):1!==this.percent?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheVideoUploadToComplete")}),s=!1):2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),s=!1):s=!0;break;case 3:"edit"!==this.operating?this.uploadStatus?this.uploadFile.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.imageCannotBeEmpty")}),s=!1):2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),s=!1):s=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),s=!1):this.uploadStatus?2===this.payType&&0===this.price?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.priceCannotBeFree")}),s=!1):s=!0:(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseWaitForTheImageUploadToComplete")}),s=!1);break;case 4:this.audioBeforeList.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.audioCannotBeEmpty")}),s=!1):s=!0;break;case 5:""===this.beAskId?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.pleaseSelectTheUserToBeAsked")}),s=!1):this.textAreaValue.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.theContentCanNotBeBlank")}),s=!1):this.watchShow&&(console.log(this.watchShow,"this.watchShow"),this.payShowStatus=!0,this.$nextTick((function(){e.$refs.payShow.payClickShow()})));break;case 6:console.log(this.dataGoodInfo.length,"^^^^~~~~~~~~"),""===this.dataGoodInfo||0===this.dataGoodInfo.length?(this.$refs.toast.show({message:this.i18n.t("core.productInformationDoesNotExist")}),s=!1):s=!0;break;default:s=!1,this.$refs.toast.show({message:this.i18n.t("core.postTypesDoNotMatch")})}if(s)if(5!==this.type&&(this.postLoading=!0,t.showLoading()),"edit"===this.operating)3===this.type?this.uploadFile.length<1?(this.$refs.toast.show({message:this.i18n.t("discuzq.post.imageCannotBeEmpty")}),t.hideLoading(),this.postLoading=!1):this.editThread().then((function(s){e.postLoading=!1,t.hideLoading(),s&&e.threadId&&t.redirectTo({url:"/topic/index?id=".concat(e.threadId)})})):(console.log("!!!!!!!~~~~~~~~~~~~~~~~~"),this.editThread().then((function(s){e.postLoading=!1,t.hideLoading(),s&&e.threadId&&t.redirectTo({url:"/topic/index?id=".concat(e.threadId)})})));else{if(this.forums.qcloud.qcloud_captcha&&this.forums.other.create_thread_with_captcha&&(!this.ticket||!this.randstr))return this.toTCaptcha(),!1;this.watchShow&&5===this.type||this.postThread().then((function(s){e.postLoading=!1,t.hideLoading(),s&&1===s.isApproved&&e.$u.event.$emit("addThread",s),s&&s._jv.json.data.id&&t.redirectTo({url:"/topic/index?id=".concat(s._jv.json.data.id)})}))}},setAnnex:function(t,e){switch(t){case"img":var s=[];e.firstPost.images.map((function(t){return s.push({path:t.thumbUrl,id:t._jv.id,order:t.order,name:t.fileName,url:t.url}),t})),this.filePreview=s;break;case"video":this.videoBeforeList.push({path:e.threadVideo.media_url});break;case"audio":this.audioBeforeList.push({fileName:e.threadAudio.file_name,url:e.threadAudio.media_url,id:e.threadAudio.file_id});break;case"goods":this.dataGoodInfo=e.firstPost.postGoods,-1!==e.firstPost.postGoods.price.indexOf("-")||Number(e.firstPost.postGoods.price)>0?this.dataGoodInfoPrice=e.firstPost.postGoods.price:Number(e.firstPost.postGoods.price)<=0&&(this.dataGoodInfoPrice="");break;default:console.log("没有匹配模式");break}},addImg:function(){var t={data:[]};return this.uploadFile.forEach((function(e){e&&t.data.push({type:"attachments",id:e.id})})),t},addFile:function(){var t={data:[]},e=this.$refs.uploadFiles.getValue();return e.forEach((function(e){e.id&&t.data.push({type:"attachments",id:e.id})})),t},addQuestion:function(){var t={data:{be_user_id:this.beAskId,price:this.priceAsk,is_onlooker:this.watchChecked,order_id:this.orderSn}};return t},deleteFile:function(t){this.deleteTip=this.i18n.t("core.deleteEnclosureSure"),this.$refs.deletePopup.open(),this.deleteType=1,this.deleteId=t},deleteFileSure:function(t){var e=this,s={_jv:{type:"attachments",id:t}};this.$store.dispatch("jv/delete",s).then((function(t){e.$refs.uploadFiles.deleteSure()}))},getCategories:function(){var t=this;this.$store.dispatch("jv/get",["categories?filter[createThread]=1",{}]).then((function(e){t.allCategories=e,e.map((function(e){return e._jv&&Number(e._jv.id)===Number(t.categoryId)&&t.checkClassData.push(e),e}))}))},postThread:function(){var t=this,e={_jv:{type:"threads",relationships:{category:{data:{type:"categories",id:this.checkClassData[0]._jv.id}}},links:{self:"threads?include=user,category,firstPost,firstPost.images,firstPost.postGoods,question,question.beUser,question.beUser.groups,question.images"}},content:this.textAreaValue,type:this.type,price:this.price,free_words:this.word,captcha_ticket:this.ticket,captcha_rand_str:this.randstr,is_anonymous:this.checked};1===this.payType?(e.attachment_price=this.price,e.price=""):0===this.payType&&(e.attachment_price="",e.price=this.price);var s=this.currentPosition;e.longitude=s.longitude||"",e.latitude=s.latitude||"",e.location=s.location||"",e.address=s.address||"";var i=new Promise((function(s,i){switch(t.type){case 0:s();break;case 1:e.title=t.postTitle,e._jv.relationships.attachments={data:t.addImg().data.concat(t.addFile().data)},s();break;case 2:e.file_id=t.fileId,e.file_name=t.videoName,s();break;case 3:e._jv.relationships.attachments=t.addImg(),s();break;case 4:e.file_id=t.audioBeforeList[0].id,e.file_name=t.audioBeforeList[0].fileName,s();break;case 5:e._jv.relationships.attachments=t.addImg(),e._jv.relationships.question=t.addQuestion(),s();break;case 6:e.post_goods_id=t.dataGoodInfo._jv.id,s();break;default:i(),t.$refs.toast.show({message:t.i18n.t("core.postTypesDoNotMatch")})}}));return i.then((function(){return t.$store.dispatch("jv/post",e).then((function(t){return t})).catch((function(t){console.log(t)}))}))},delAttachments:function(t,e){if("edit"===this.operating){this.$u.event.$emit("deleteImg",{threadId:this.postDetails._jv.id,index:e});var s=this.$store.getters["jv/get"]("posts/".concat(this.postDetails.firstPost._jv.id));s.images.splice(e,1),s._jv.relationships.images.data.splice(e,1)}},handleClickOk:function(){this.$refs.deletePopup.close(),0===this.deleteType?(this.delAttachments(this.deleteId,this.deleteIndex),this.$refs.upload.clear(this.deleteIndex)):2===this.deleteType?(this.videoBeforeList=[],this.percent=0):3===this.deleteType&&(this.audioBeforeList=[])},handleClickCancel:function(){this.$refs.deletePopup.close()},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()}},m(i,"delAttachments",(function(t,e){if("edit"===this.operating){console.log("这是编辑"),this.$u.event.$emit("deleteImg",{threadId:this.postDetails._jv.id,index:e});var s=this.$store.getters["jv/get"]("posts/".concat(this.postDetails.firstPost._jv.id));s.images.splice(e,1),s._jv.relationships.images.data.splice(e,1)}this.uploadFile.forEach((function(e,s,i){e.id==t&&i.splice(s,1)}))})),m(i,"getSignature",(function(t){this.$store.dispatch("jv/get",["signature",{}]).then((function(e){t(e.signature)}))})),m(i,"postVideo",(function(t){var e={_jv:{type:"thread/video"},file_id:t,type:0};this.$store.dispatch("jv/post",e)})),m(i,"getPostThread",(function(t){var e=this,s={include:["firstPost","firstPost.images","threadVideo","threadAudio","category","firstPost.attachments","question","onlookers","question.beUser","question.images","firstPost.postGoods"]};this.$store.dispatch("jv/get",["threads/".concat(this.threadId),{params:s}]).then((function(s){switch(s.question&&(e.beUserName=s.question.beUser.username,e.beAskId=s.question.beUser.id,e.userImage=s.question.beUser.avatarUrl),e.postDetails=s,e.firstPostId=s.firstPost._jv.id,e.type=s.type,e.markdownShow=!1,e.attachmentList=s.firstPost.attachments||[],e.textAreaValue=s.firstPost.content,e.categoryId=s.category._jv.id,e.checkClassData.push(s.category),s.threadVideo&&(e.fileId=s.threadVideo.file_id,e.percent=1),s.firstPost.images&&s.firstPost.images.forEach((function(t){t&&e.uploadFile.push({type:"attachments",id:t._jv.id,order:t.order,name:t.fileName,url:t.url,path:t.thumbUrl?t.thumbUrl:""})})),6===e.type&&s.firstPost.postGoods&&(e.dataGoodInfo=s.firstPost.postGoods,-1!==s.firstPost.postGoods.price.indexOf("-")||Number(s.firstPost.postGoods.price)>0?e.dataGoodInfoPrice=s.firstPost.postGoods.price:Number(s.firstPost.postGoods.price)<=0&&(e.dataGoodInfoPrice=""),e.isShowGoods=!0,console.log(e.dataGoodInfo,e.isShowGoods,"这是~~~~~~~~~~~~~~~")),e.loadStatus=!0,Number(s.price)>0?(e.price=s.price,e.word=s.freeWords,e.freepercentage.forEach((function(t){s.freeWords===t.pay&&(e.percentagedisplay=t.name)})),e.payType=2,e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsPaid"),1===e.type&&(e.payNum[0].name="￥1",e.payNum[0].pay=1)):Number(s.attachmentPrice)>0?(e.price=s.attachmentPrice,e.payType=1,e.showPayType=e.i18n.t("discuzq.post.TheContentIsFreeAndTheAccessoriesArePaid"),e.payNum[0].name="￥1",e.payNum[0].pay=1):e.showPayType=e.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"),e.textAreaLength=1===e.type?49999:5e3,Number(s.type)){case 0:break;case 1:e.postTitle=s.title,e.setAnnex("img",s);break;case 2:e.percent=1,e.setAnnex("video",s);break;case 3:e.setAnnex("img",s);break;case 4:e.setAnnex("audio",s);break;case 6:e.setAnnex("goods",s);break;default:console.log("未知类型")}if(t.name){var i={},o=t.latng.split(",");i.longitude=o[1],i.latitude=o[0],i.location=t.name,i.address=t.addr,e.currentPosition=i}else e.currentPosition.longitude=s.longitude||"",e.currentPosition.latitude=s.latitude||"",e.currentPosition.location=s.location||"",e.currentPosition.address=s.address||"";"edit"===e.operating&&e.goodsId&&e.getGoodsInfo(),e.setThread()}))})),m(i,"getGoodsInfo",(function(){var t=this;console.log("获取"),this.$store.dispatch("jv/get","goods/".concat(this.goodsId)).then((function(e){console.log("这是取到的商品信息",e),t.dataGoodInfo=e,-1!==e.price.indexOf("-")||Number(e.price)>0?t.dataGoodInfoPrice=e.price:Number(e.price)<=0&&(t.dataGoodInfoPrice=""),t.isShowGoods=!0}))})),m(i,"editThread",(function(){var t=this;return p(o.default.mark((function e(){var s,i,a,n;return o.default.wrap((function(e){while(1)switch(e.prev=e.next){case 0:console.log("编辑"),s=0,i={_jv:{type:"posts",id:t.firstPostId,relationships:{},links:{self:"posts/".concat(t.firstPostId,"?include=user,thread,images")}},content:t.textAreaValue},a={_jv:{type:"threads",id:t.threadId,relationships:{category:{data:{type:"categories",id:t.checkClassData[0]._jv.id}}}}},n=t.currentPosition,a.longitude=n.longitude||"",a.latitude=n.latitude||"",a.location=n.location||"",a.address=n.address||"",e.t0=t.type,e.next=0===e.t0?12:1===e.t0?13:2===e.t0?18:3===e.t0?22:4===e.t0?25:5===e.t0?29:6===e.t0?31:35;break;case 12:return e.abrupt("break",36);case 13:return a.title=t.postTitle,1===t.payType?(a.attachment_price=t.price,a.price=""):2===t.payType?(a.attachment_price="",a.price=t.price):0===t.payType&&(a.attachment_price="",a.price=""),a.free_words=t.word,i._jv.relationships.attachments={data:t.addFile().data},e.abrupt("break",36);case 18:return a.file_id=t.fileId,a.file_name=t.videoName,a.price=t.price,e.abrupt("break",36);case 22:return a.price=t.price,i._jv.relationships.attachments=t.addImg(),e.abrupt("break",36);case 25:return a.price=t.price,a.file_id=t.audioBeforeList[0].id,a.file_name=t.audioBeforeList[0].fileName,e.abrupt("break",36);case 29:return i._jv.relationships.attachments=t.addImg(),e.abrupt("break",36);case 31:return console.log("666666"),i.post_goods_id=t.dataGoodInfo._jv.id,console.log(a,"666666"),e.abrupt("break",36);case 35:return e.abrupt("break",36);case 36:return e.next=38,t.$store.dispatch("jv/patch",i).then((function(t){return console.log(t,"返回"),t._jv.json.data.id&&(s+=1),t._jv.json.data.attributes.isApproved,t}));case 38:return e.next=40,t.$store.dispatch("jv/patch",a).then((function(t){t._jv.json.data.id&&(s+=1)}));case 40:if(2!==s){e.next=42;break}return e.abrupt("return",s);case 42:throw new Error("出错了");case 43:case"end":return e.stop()}}),e)})))()})),m(i,"toTCaptcha",(function(){var e=this;wx.navigateToMiniProgram({appId:"wx5a3a7366fd07e119",path:"/pages/captcha/index",envVersion:"release",extraData:{appId:this.forums.qcloud.qcloud_captcha_app_id},success:function(t){},fail:function(s){t.hideLoading(),e.postLoading=!1}})})),m(i,"changeAvatar",(function(){t.navigateTo({url:"/pages/user/at-member?name=select"})})),i)),onLoad:function(e){var s=this;console.log(e,"optionopton"),"5"===e.type&&(this.payNum[0].name=this.i18n.t("discuzq.post.noReward")),this.categoryid=e.categoryId,this.categoryindex=e.categoryIndex,t.$on("radioChange",(function(t){s.beUserName=t.username,s.beAskId=t.id,s.userImage=t.avatarUrl})),this.forums&&this.forums.other&&(this.canUploadAttachment=this.forums.other.can_upload_attachments),this.forums&&this.forums.paycenter&&("edit"!==e.operating&&this.forums.paycenter.wxpay_close?this.showPayType=this.i18n.t("discuzq.post.TheContentAndTheAccessoriesIsFree"):this.askingPrice=!1),e.type&&(this.type=Number(e.type));var i=t.getSystemInfoSync();"ios"===i.platform&&5===this.type&&(this.askingPrice=!1),this.url=n.DISCUZ_REQUEST_HOST;var o=t.getStorageSync("access_token");if(this.header={authorization:"Bearer ".concat(o)},this.formData={type:1},this.getCategories(),e.operating&&(this.operating=e.operating),e.threadId&&(this.threadId=e.threadId),e.categoryIndex&&("0"===e.categoryIndex?this.categoryIndex="":this.categoryIndex=Number(e.categoryIndex)),e.categoryId&&(this.categoryId=0===Number(e.categoryId)?"":Number(e.categoryId)),this.textAreaLength=1===Number(e.type)?49999:5e3,"edit"===this.operating)this.loadStatus=!1,this.getPostThread(e);else if(this.loadStatus=!0,e.name){var a={},r=e.latng.split(",");a.longitude=r[1],a.latitude=r[0],a.location=e.name,a.address=e.addr,this.currentPosition=a}try{var c=t.getSystemInfoSync();this.forums&&this.forums.paycenter.wxpay_close&&this.forums.other.can_create_thread_paid?"ios"===c.platform?this.ioshide=!1:(this.ioshide=!0,this.showHidden=!0):(this.ioshide=!1,this.showHidden=!1)}catch(d){}if(this.markdownShow=!1,this.$u.event.$on("captchaResult",(function(t){s.ticket=t.ticket,s.randstr=t.randstr,s.postClick()})),this.$u.event.$on("closeChaReault",(function(){s.postLoading=!1,t.hideLoading()})),t.$on("clickTopic",(function(t){t.keywords&&(s.textAreaValue="".concat(s.textAreaValue.slice(0,s.cursor),"  #").concat(t.keywords.replace(/\s+/g,""),"#").concat(s.textAreaValue.slice(s.cursor),"  ")),s.cursor=s.textAreaValue?s.textAreaValue.length:0})),6===this.type&&(this.goodsId=e.goodsId,console.log(e,this.goodsId,"这是参数")),(6===this.type&&"edit"!==e.operating&&""!==e.threadId&&this.goodsId||6===this.type&&this.goodsId)&&this.getGoodsInfo(),2===this.type||3===this.type){var u=this.getOpenerEventChannel();u.on("acceptDataFromOpenerPage",(function(t){3===s.type&&(t.map((function(t){s.uploadFile.push({type:"attachments",id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url,path:t.data.attributes.thumbUrl?t.data.attributes.thumbUrl:""}),s.filePreview.push({path:t.data.attributes.thumbUrl,id:t.data.id,order:t.data.attributes.order,name:t.data.attributes.fileName,url:t.data.attributes.url})})),s.addImg()),2===s.type&&t.data&&(t.data.doneResult?s.fileId=t.data.doneResult.fileId:s.fileId=t.data.result.fileId,s.videoBeforeList.push({path:t.data.uploadVideoRes.tempFilePath}),s.chooseType=0,s.percent=1)}))}},onShow:function(){var t="";this.getAtMemberData.map((function(e){return t+="@".concat(e.username," "),t})),this.textAreaValue="".concat(this.textAreaValue.slice(0,this.cursor)+t+this.textAreaValue.slice(this.cursor)),this.setAtMember([]),this.cursor=this.textAreaValue?this.textAreaValue.length:0,this.threadId||this.setThread()},onReady:function(){this.videoContext=t.createVideoContext("video")},onUnload:function(){this.$u.event.$off("captchaResult"),this.$u.event.$off("closeChaReault"),this.$u.event.$off("radioChange"),this.$u.event.$off("radioEditChange"),this.captcha&&this.captcha.destroy(),clearInterval(g),clearInterval(v)}};e.default=_}).call(this,s("543d")["default"])}},[["d497","common/runtime","common/vendor"]]]);