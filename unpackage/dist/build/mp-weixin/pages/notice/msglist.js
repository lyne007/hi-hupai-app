(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/notice/msglist"],{"0159":function(t,e,o){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var i=o("4317"),n=function(){o.e("components/qui-emoji/qui-emoji").then(function(){return resolve(o("aa0f"))}.bind(null,o)).catch(o.oe)},s={components:{quiEmoji:n},data:function(){return{username:"",scrollTop:0,old:{scrollTop:0,focus:!1},msg:"",emojiShow:!1,dialogId:0,height:0,scv:0,bottomPadding:10,pageSize:20,pageNum:1,navbarHeight:0,cursor:0,focus:!0}},computed:{currentLoginId:function(){var t=this.$store.getters["session/get"]("userId");return parseInt(t,10)},allChatRecord:function(){var t=[],e=this.$store.getters["jv/get"]("dialog_message"),o=Object.keys(e);if(e&&o.length>0)for(var n=0;n<o.length;n+=1){var s=e[o[n]];s.dialog_id.toString()===this.dialogId&&(s.time=(0,i.time2DateAndHM)(s.created_at),s.user=this.$store.getters["jv/get"]("users/".concat(s.user_id)),t.push(s))}return t},allEmoji:function(){return this.$store.getters["jv/get"]("emoji")},userInfo:function(){return this.$store.getters["jv/get"]("users/".concat(this.currentLoginId))}},watch:{allChatRecord:function(){this.scrollToBottom()}},created:function(){if(getApp()&&getApp().systemInfo&&getApp().systemInfo.screenWidth&&getApp().systemInfo.windowHeight){var e=getApp().systemInfo.screenWidth/750;this.scv=getApp().systemInfo.windowHeight/e-140}else try{getApp().systemInfo=t.getSystemInfoSync();var o=getApp().systemInfo.screenWidth/750;this.scv=getApp().systemInfo.windowHeight/o-140}catch(i){console.error("Painter get system info failed, ".concat(JSON.stringify(i)))}},onLoad:function(e){var o=this;this.navbarHeight=t.getSystemInfoSync().statusBarHeight+44;var i=e.username,n=e.dialogId;n&&(this.dialogId=n),i&&(this.username=i),this.getChatRecord(n),Object.keys(this.allEmoji).length<1&&this.getEmoji(),t.onKeyboardHeightChange((function(t){t.height>0?o.$nextTick((function(){o.scrollTop+=t.height})):o.$nextTick((function(){o.scrollTop-=t.height}))}))},methods:{scrollToBottom:function(){var e=this;this.$nextTick((function(){t.createSelectorQuery().selectAll(".chat-box__con").boundingClientRect().exec((function(t){var o=0;t[0].forEach((function(t){o+=t.height})),o>600&&(e.scrollTop=o-658+10,e.old.scrollTop=o-658+10)}))}))},toUpper:function(){t.startPullDownRefresh(),this.pageNum+=1,this.getChatRecord(this.dialogId)},scroll:function(t){t&&t.detail&&(this.old.scrollTop=t.detail.scrollTop)},getChatRecord:function(e){if("0"!==e){t.showNavigationBarLoading();var o={"filter[dialog_id]":e||this.dialogId,include:["user","user.groups"],"page[number]":this.pageNum,"page[limit]":this.pageSize,sort:"-createdAt"};this.$store.commit("jv/clearRecords",{_jv:{type:"dialog/message"}}),this.$store.dispatch("jv/get",["dialog/message",{params:o}]).then((function(e){e&&(t.hideNavigationBarLoading(),t.stopPullDownRefresh())})).catch((function(t){console.log(t)}))}},getEmoji:function(){this.$store.dispatch("jv/get",["emoji",{}])},cursorBlur:function(e){e&&e.detail&&(this.cursor=e.detail.cursor,e.detail.value.length>450&&t.showToast({icon:"none",title:this.i18n.t("notice.contentMaxLength"),duration:2e3}))},cursorFocus:function(t){t&&(this.emojiShow=!1)},send:function(){var e=this;if(""===this.msg)t.showToast({icon:"none",title:this.i18n.t("notice.emptycontent"),duration:2e3});else if(this.msg.length>450)t.showToast({icon:"none",title:this.i18n.t("notice.contentMaxLength"),duration:2e3});else{if(console.log("---------this.dialogId",this.dialogId),console.log("---------type",typeof this.dialogId),"0"===this.dialogId){var o={_jv:{type:"dialog"},recipient_username:this.username,message_text:this.msg};this.$store.dispatch("jv/post",o).then((function(t){t&&(e.dialogId=t._jv.id,e.getChatRecord(t._jv.id))})).catch((function(o){o&&o.data&&o.data.errors&&("content_banned"===o.data.errors[0].code&&t.showToast({icon:"none",title:e.i18n.t("core.content_banned"),duration:2e3}),"permission_denied"===o.data.errors[0].code&&t.showToast({icon:"none",title:e.i18n.t("core.permission_denied"),duration:2e3}))}))}else{var i={_jv:{type:"dialog/message"},dialog_id:this.dialogId,message_text:this.msg};this.$store.dispatch("jv/post",i).then((function(t){t&&e.scrollToBottom()})).catch((function(o){o&&o.data&&o.data.errors&&("content_banned"===o.data.errors[0].code&&t.showToast({icon:"none",title:e.i18n.t("core.content_banned"),duration:2e3}),"permission_denied"===o.data.errors[0].code&&t.showToast({icon:"none",title:e.i18n.t("core.permission_denied"),duration:2e3}))}))}this.msg="",this.emojiShow=!1}},popEmoji:function(){var t=this;this.emojiShow?(this.scrollTop=this.old.scrollTop,this.scrollToBottom(),this.bottomPadding-=204):(this.scrollTop=this.old.scrollTop,this.scrollToBottom(!0),this.bottomPadding+=204,this.$nextTick((function(){t.scrollTop+=204}))),this.emojiShow=!this.emojiShow},getEmojiClick:function(e){var o=this;this.focus=this.old.focus;var i="";i="".concat(this.msg.slice(0,this.cursor)+e+this.msg.slice(this.cursor)),this.msg=i,this.cursor+=e.length,this.$nextTick((function(){o.focus=!0,t.hideKeyboard()}))},jumpUserPage:function(e){e&&t.navigateTo({url:"/pages/profile/index?userId=".concat(e)})}}};e.default=s}).call(this,o("543d")["default"])},3414:function(t,e,o){"use strict";o.r(e);var i=o("b670"),n=o("91ea");for(var s in n)"default"!==s&&function(t){o.d(e,t,(function(){return n[t]}))}(s);o("d9c3");var r,c=o("f0c5"),a=Object(c["a"])(n["default"],i["b"],i["c"],!1,null,"2b29d6ec",null,!1,i["a"],r);e["default"]=a.exports},"4b28":function(t,e,o){},"91ea":function(t,e,o){"use strict";o.r(e);var i=o("0159"),n=o.n(i);for(var s in i)"default"!==s&&function(t){o.d(e,t,(function(){return i[t]}))}(s);e["default"]=n.a},b670:function(t,e,o){"use strict";o.d(e,"b",(function(){return n})),o.d(e,"c",(function(){return s})),o.d(e,"a",(function(){return i}));var i={quiPage:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-page/qui-page")]).then(o.bind(null,"2bf0"))},quiAvatar:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-avatar/qui-avatar")]).then(o.bind(null,"ce3f"))},quiUparse:function(){return Promise.all([o.e("common/vendor"),o.e("components/qui-uparse/qui-uparse")]).then(o.bind(null,"62d3"))},quiIcon:function(){return o.e("components/qui-icon/qui-icon").then(o.bind(null,"5d1d"))},quiEmoji:function(){return o.e("components/qui-emoji/qui-emoji").then(o.bind(null,"aa0f"))}},n=function(){var t=this,e=t.$createElement,o=(t._self._c,t.$u.light()),i=t.i18n.t("notice.send");t.$mp.data=Object.assign({},{$root:{g0:o,g1:i}})},s=[]},c336:function(t,e,o){"use strict";(function(t){o("3768");i(o("66fd"));var e=i(o("3414"));function i(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,o("543d")["createPage"])},d9c3:function(t,e,o){"use strict";var i=o("4b28"),n=o.n(i);n.a}},[["c336","common/runtime","common/vendor"]]]);