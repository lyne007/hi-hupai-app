(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/user/register-bind"],{"4e03":function(t,e,a){"use strict";a.r(e);var r=a("9b5d"),s=a("68f1");for(var i in s)"default"!==i&&function(t){a.d(e,t,(function(){return s[t]}))}(i);a("8a98");var n,o=a("f0c5"),u=Object(o["a"])(s["default"],r["b"],r["c"],!1,null,"345a6910",null,!1,r["a"],n);e["default"]=u.exports},"50c5":function(t,e,a){"use strict";(function(t){a("3768");r(a("66fd"));var e=r(a("4e03"));function r(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,a("543d")["createPage"])},"68f1":function(t,e,a){"use strict";a.r(e);var r=a("c5b2"),s=a.n(r);for(var i in r)"default"!==i&&function(t){a.d(e,t,(function(){return r[t]}))}(i);e["default"]=s.a},"8a98":function(t,e,a){"use strict";var r=a("dfd9"),s=a.n(r);s.a},"9b5d":function(t,e,a){"use strict";a.d(e,"b",(function(){return s})),a.d(e,"c",(function(){return i})),a.d(e,"a",(function(){return r}));var r={quiPage:function(){return Promise.all([a.e("common/vendor"),a.e("components/qui-page/qui-page")]).then(a.bind(null,"2bf0"))},quiRegistrationAgreement:function(){return a.e("components/qui-registration-agreement/qui-registration-agreement").then(a.bind(null,"e80a"))}},s=function(){var t=this,e=t.$createElement,a=(t._self._c,t.type?t.i18n.t("user.registerBindId"):null),r=t.type?null:t.i18n.t("user.registerBindUcenter"),s=t.i18n.t("user.dear"),i=t.isBind?t.i18n.t("user.registerBindText"):null,n=t.isBind?null:t.i18n.t("user.changeRegisterBindText"),o=t.i18n.t("user.username"),u=t.i18n.t("user.password"),d=t.forum&&t.forum.set_reg&&t.forum.set_reg.register_validate?t.i18n.t("user.reason"):null,c=t.type?t.i18n.t("user.registerBind"):null,f=t.type?null:t.i18n.t("user.registerBindUc"),g=t.i18n.t("user.login");t.$mp.data=Object.assign({},{$root:{g0:a,g1:r,g2:s,g3:i,g4:n,g5:o,g6:u,g7:d,g8:c,g9:f,g10:g}})},i=[]},c5b2:function(t,e,a){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var r=n(a("245a")),s=n(a("412c")),i=a("0301");function n(t){return t&&t.__esModule?t:{default:t}}var o={mixins:[r.default,s.default],data:function(){return{username:"",password:"",reason:"",site_mode:"",forum:{},isPaid:!1,captcha:null,captcha_ticket:"",captcha_rand_str:"",ticket:"",randstr:"",captchaResult:{},type:!0}},onLoad:function(){var e=this,a=getCurrentPages(),r=a[a.length-1].route;"pages/user/uc-login"===r&&(this.type=!1),this.getForum(),this.$u.event.$on("captchaResult",(function(t){e.ticket=t.ticket,e.randstr=t.randstr,e.addRegisterParams()})),this.$u.event.$on("closeChaReault",(function(){t.hideLoading()}))},onUnload:function(){this.$u.event.$off("captchaResult"),this.$u.event.$off("closeChaReault"),this.captcha&&this.captcha.destroy()},computed:{userInfo:function(){var e=t.getStorageSync("userInfo");return e},isBind:function(){var e=t.getStorageSync("isBind");return e}},methods:{handleRegister:function(){""===this.username?t.showToast({icon:"none",title:this.i18n.t("user.usernameEmpty"),duration:2e3}):""===this.password?t.showToast({icon:"none",title:this.i18n.t("user.passwordEmpty"),duration:2e3}):this.forum&&this.forum.set_reg&&this.forum.set_reg.register_captcha?this.toTCaptcha():this.addRegisterParams()},addRegisterParams:function(){var e={data:{attributes:{username:this.username,password:this.password}}};this.isBind||(e.data.attributes.rebind=1);var a=this.$store.getters["session/get"]("params");if(a&&a.data&&a.data.attributes&&(e.data.attributes.js_code=a.data.attributes.js_code,e.data.attributes.iv=a.data.attributes.iv,e.data.attributes.encryptedData=a.data.attributes.encryptedData),!this.type){var r=t.getStorageSync("token");""!==r&&(e.data.attributes.token=r)}this.forum&&this.forum.set_reg&&this.forum.set_reg.register_captcha&&(e.data.attributes.captcha_ticket=this.ticket,e.data.attributes.captcha_rand_str=this.randstr),this.forum&&this.forum.set_reg&&this.forum.set_reg.register_validate&&""!==this.reason&&(e.data.attributes.register_reason=this.reason);var s=t.getStorageSync("inviteCode");""!==s&&(e.data.attributes.code=s),this.register(e,this.i18n.t("user.registerBindSuccess"))},toTCaptcha:function(e,a){wx.navigateToMiniProgram({appId:"wx5a3a7366fd07e119",path:"/pages/captcha/index",envVersion:"release",extraData:{appId:this.forum.qcloud.qcloud_captcha_app_id},success:function(){console.log("验证码成功打开")},fail:function(){t.hideLoading()}})},register:function(e,a){var r=this;this.$store.dispatch("session/h5Register",e).then((function(e){if(e&&e.data&&e.data.data&&e.data.data.id&&(r.refreshmpParams(),r.logind(),r.forum&&r.forum.set_site&&r.forum.set_site.site_mode!==i.SITE_PAY&&t.getStorage({key:"page",success:function(e){t.redirectTo({url:e.data})}}),r.forum&&r.forum.set_site&&r.forum.set_site.site_mode===i.SITE_PAY&&r.user&&!r.user.paid&&t.redirectTo({url:"/pages/site/info"}),t.showToast({title:a,duration:2e3})),e&&e.data&&e.data.errors){if(r.refreshmpParams(),"401"===e.data.errors[0].status||"402"===e.data.errors[0].status||"500"===e.data.errors[0].status){var s=r.i18n.t("core.".concat(e.data.errors[0].code));t.showToast({icon:"none",title:s,duration:2e3})}if("403"===e.data.errors[0].status||"422"===e.data.errors[0].status){var n=r.i18n.t(e.data.errors[0].detail[0]);t.showToast({icon:"none",title:n,duration:2e3})}}})).catch((function(t){console.log(t)}))},jump2Login:function(){this.jump2LoginBindPage()}}};e.default=o}).call(this,a("543d")["default"])},dfd9:function(t,e,a){}},[["50c5","common/runtime","common/vendor"]]]);