(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/share/topic"],{"03bb":function(t,e,i){"use strict";i.r(e);var n=i("8997"),s=i("4087");for(var o in s)"default"!==o&&function(t){i.d(e,t,(function(){return s[t]}))}(o);i("cb96");var a,h=i("f0c5"),c=Object(h["a"])(s["default"],n["b"],n["c"],!1,null,"42e56000",null,!1,n["a"],a);e["default"]=c.exports},4087:function(t,e,i){"use strict";i.r(e);var n=i("f418"),s=i.n(n);for(var o in n)"default"!==o&&function(t){i.d(e,t,(function(){return n[t]}))}(o);e["default"]=s.a},7676:function(t,e,i){"use strict";(function(t){i("3768");n(i("66fd"));var e=n(i("03bb"));function n(t){return t&&t.__esModule?t:{default:t}}t(e.default)}).call(this,i("543d")["createPage"])},8997:function(t,e,i){"use strict";i.d(e,"b",(function(){return s})),i.d(e,"c",(function(){return o})),i.d(e,"a",(function(){return n}));var n={quiPage:function(){return Promise.all([i.e("common/vendor"),i.e("components/qui-page/qui-page")]).then(i.bind(null,"2bf0"))},quiToast:function(){return i.e("components/qui-toast/qui-toast").then(i.bind(null,"6512"))},quiButton:function(){return i.e("components/qui-button/qui-button").then(i.bind(null,"a67c"))}},s=function(){var t=this,e=t.$createElement,i=(t._self._c,t.i18n.t("share.savealbum"));t.$mp.data=Object.assign({},{$root:{g0:i}})},o=[]},a661:function(t,e,i){},cb96:function(t,e,i){"use strict";var n=i("a661"),s=i.n(n);s.a},f418:function(t,e,i){"use strict";(function(t){Object.defineProperty(e,"__esModule",{value:!0}),e.default=void 0;var n=r(i("582e")),s=r(i("bef0")),o=r(i("3798")),a=r(i("183d")),h=r(i("aeaa")),c=r(i("8605"));function r(t){return t&&t.__esModule?t:{default:t}}var u={mixins:[c.default],data:function(){return{imagePath:"",width:700,template:{},userid:"",slitename:"",slitelogo:"",themeid:"",headerImg:"",headerName:"",postyTepy:"",subHeading:"",contentTitle:"",content:"",contentImg:[],video:"",videoduc:"",videotime:"",attachmentsType:"",themwidth:180,renamewidth:400,reconame:"",recoimg:"",constyle:0,paddingtop:43,imgtop:0,jurisdiction:!0,that:"",attachlength:97,marglength:160,heightdefill:"",picutre:"",picutrecopy:"",contentheight:"",implement:""}},onLoad:function(t){this.showToast(),this.themeid=t.id,this.userid=this.usersid,this.slitename=this.forums.set_site.site_name,this.slitelogo=this.forums.set_site.site_logo||"".concat(this.$u.host(),"static/logo.png"),this.getusertitle()},computed:{usersid:function(){return this.$store.getters["session/get"]("userId")},userInfo:function(){return this.$store.getters["jv/get"]("users/".concat(this.userid))}},watch:{heightdefill:{handler:function(t){(t||0===t)&&this.initData()},deep:!0},content:{handler:function(t){t&&this.implement&&this.initData()},deep:!0}},methods:{getusertitle:function(){this.reconame=this.userInfo.username,this.recoimg=this.userInfo.avatarUrl||"".concat(this.$u.host(),"static/noavatar.gif"),this.getthemdata()},showToast:function(){this.$refs.toast.showLoading({icon:"icon-load",message:this.i18n.t("share.generating"),position:"middle"})},openLoading:function(){this.$refs.toast.close()},getthemdata:function(){var e=this,i=this;this.$store.dispatch("jv/get","threads/".concat(this.themeid,"?include=user,firstPost,firstPost.images,threadVideo,category")).then((function(n){if(e.headerName=n.user.username,e.postyTepy=n.type,e.headerImg=n.user.avatarUrl||"".concat(e.$u.host(),"static/images/noavatar.gif"),n.price>0)e.contentImg.push(e.slitelogo),e.contentImg&&t.getImageInfo({src:i.contentImg[0],success:function(t){var e=t.width/(t.height/100);i.heightdefill=(700-e)/2}}),e.attachmentsType=n.category.name;else{n.firstPost.images.length>=1||2===e.postyTepy?(2===e.postyTepy&&n.threadVideo.cover_url,e.implement=!1):e.implement=!0;var s=Object.values(n.firstPost.images);s.forEach((function(t){e.contentImg.push(t.url||t.thumbUrl)})),e.contentImg&&t.getImageInfo({src:i.contentImg[0],success:function(t){var e=t.height*(620/t.width);i.heightdefill=e-402}}),e.contentTitle=n.title,e.content=n.firstPost.content;var o=e.content.length-e.content.replace(/[\r\n]/g,"").length;if(e.content){var a=Math.ceil(e.content.length/23)+o;e.contentheight=a>=11?0:472-42*a}e.attachmentsType=n.category.name,e.attachlength=24*e.attachmentsType.length+3,e.marglength=e.attachlength+40,2===e.postyTepy&&(e.video=n.threadVideo.cover_url,e.videoduc=n.threadVideo.file_name,e.video?t.getImageInfo({src:i.video,success:function(t){var e=t.height*(620/t.width);i.heightdefill=e-402}}):i.heightdefill=0)}}))},initData:function(){this.contentTitle||(this.imgtop=80);var t={username:this.headerName,userheader:this.headerImg,usertitle:this.contentTitle,usercontent:this.content,usercontimg:this.contentImg,userattname:this.attachmentsName,useratttype:this.attachmentsType,userweixincode:"".concat(this.$u.host(),"api/oauth/wechat/miniprogram/code?path=/topic/index?id=").concat(this.themeid),slitename:this.slitename,uservideo:this.video,uservideoduc:this.videoduc,namewidth:this.themwidth,renamewidth:this.renamewidth,reconame:this.reconame+this.i18n.t("share.recomment"),recoimg:this.recoimg,imgtop:this.imgtop,attachlength:this.attachlength,marglength:this.marglength,heightdefill:this.heightdefill,contentheight:this.contentheight,longpressrecog:this.i18n.t("share.longpressrecog"),recomment:this.i18n.t("share.recomment"),goddessvideo:this.attachmentsType,comefrom:this.i18n.t("share.comefrom"),stay:this.i18n.t("share.stay"),published:this.i18n.t("share.published"),contents:this.i18n.t("share.contents")};this.contentTitle?1===this.contentImg.length||this.contentImg.length>1?(this.constyle=1100+this.heightdefill,this.paddingtop=43,this.template=(new s.default).palette(t)):0===this.contentImg.length&&this.content?(this.constyle=1083-this.contentheight,this.paddingtop=41,this.template=(new n.default).palette(t)):2===this.postyTepy&&(this.constyle=1100+this.heightdefill,this.paddingtop=43,this.template=(new a.default).palette(t)):this.contentTitle?(this.constyle=1082-this.contentheight,this.paddingtop=46,this.template=(new h.default).palette(t)):this.content&&1===this.contentImg.length?(this.constyle=1100+this.heightdefill,this.paddingtop=43,this.template=(new s.default).palette(t)):this.content||1!==this.contentImg.length?this.content&&this.contentImg.length>1?(this.constyle=1100+this.heightdefill,this.paddingtop=43,this.template=(new s.default).palette(t)):2===this.postyTepy?(this.constyle=1100+this.heightdefill,this.paddingtop=43,this.template=(new a.default).palette(t)):(this.constyle=1082-this.contentheight,this.paddingtop=46,this.template=(new h.default).palette(t)):(this.constyle=728,this.paddingtop=90,this.template=(new o.default).palette(t))},onImgOK:function(t){this.imagePath=t.detail.path,this.openLoading()},imgErr:function(){this.openLoading(),t.showModal({title:this.i18n.t("discuzq.msgbox.title"),content:this.i18n.t("share.buildfailed"),showCancel:!1})},fun:function(){var e=this;t.getSetting({success:function(t){t.authSetting["scope.writePhotosAlbum"]?e.jurisdiction=t.authSetting["scope.writePhotosAlbum"]:e.jurisdiction=!1}}),this.jurisdiction||t.openSetting({success:function(t){e.jurisdiction=t.authSetting["scope.writePhotosAlbum"]}}),t.showModal({title:e.i18n.t("discuzq.msgbox.title"),content:e.i18n.t("share.confirm"),success:function(i){i.confirm&&t.saveImageToPhotosAlbum({filePath:e.imagePath,success:function(){t.showToast({title:e.i18n.t("share.successfully"),icon:"none",duration:2e3})},fail:function(i){"saveImageToPhotosAlbum:fail auth deny"===i.errMsg&&(e.jurisdiction=!1),t.showToast({title:e.i18n.t("share.savefailed"),icon:"none",duration:2e3})}})}})},previewImage:function(){var e=this.imagePath;t.previewImage({current:e,urls:[e]})}}};e.default=u}).call(this,i("543d")["default"])}},[["7676","common/runtime","common/vendor"]]]);