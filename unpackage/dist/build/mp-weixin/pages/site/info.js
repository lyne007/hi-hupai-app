(global["webpackJsonp"]=global["webpackJsonp"]||[]).push([["pages/site/info"],{6007:function(e,t,n){"use strict";(function(e){Object.defineProperty(t,"__esModule",{value:!0}),t.default=void 0;var i=a(n("8605")),o=a(n("412c")),s=n("198a");function a(e){return e&&e.__esModule?e:{default:e}}var r=function(){n.e("components/uni-popup/uni-popup-dialog").then(function(){return resolve(n("8b8a"))}.bind(null,n)).catch(n.oe)},u=null,c={components:{uniPopupDialog:r},mixins:[i.default,o.default],data:function(){return{payShowStatus:!0,codeUrl:"",shareShow:!1,isAnonymous:"0",qrcodeShow:!1,isWeixin:"",isPhone:!1,wxRes:"",browser:0,payStatus:!1,orderSn:"",isLogin:this.$store.getters["session/get"]("isLogin"),wechatTip:this.i18n.t("discuzq.wechatBind"),payTypeData:[{name:this.i18n.t("pay.wxPay"),icon:"icon-wxPay",color:"#09bb07",value:"0"}]}},computed:{pay:function(){return this.i18n.t("pay")},userId:function(){return this.$store.getters["session/get"]("userId")},user:function(){return this.$store.getters["jv/get"]("users/".concat(this.userId))}},created:function(){this.$u.event.$on("refresh",(function(){window.location.reload()}))},onLoad:function(){e.hideHomeButton(),wx.showShareMenu({withShareTicket:!0,menus:["shareAppMessage","shareTimeline"]}),this.$u.event.$on("logind",(function(t){t.paid&&e.redirectTo({url:"/pages/home/index"})})),this.userId&&this.userInfo()},onUnload:function(){clearInterval(u)},onShareAppMessage:function(e){return e.from,{title:this.forums.set_site.site_name}},onShareTimeline:function(){return{title:this.forums.set_site.site_name,query:""}},methods:{userInfo:function(){var e={include:"groups"};this.$store.dispatch("jv/get",["users/".concat(this.userId),{params:e}]).then((function(e){e.paid&&(window.location.href="/pages/home/index")}))},radioMyHead:function(e){this.isAnonymous=e},onInput:function(e){this.value=e,this.creatOrder(this.forums.set_site.site_price,1,e)},handleWechatClickOk:function(){this.mpLogin()},handleWechatClickCancel:function(){this.$refs.wechatPopup.close()},paysureShow:function(){e.setStorage({key:"page",data:"/pages/site/info"}),void 0===this.user.wechat||this.user.wechat&&""===this.user.wechat.min_openid?this.$refs.wechatPopup.open():this.creatOrder(this.forums.set_site.site_price,1,this.value)},creatOrder:function(e,t,n){var i=this,o={_jv:{type:"orders"},type:t,amount:e,is_anonymous:this.isAnonymous};this.$store.dispatch("jv/post",o).then((function(e){i.orderSn=e.order_sn,0===i.browser?i.orderPay(13,n,i.orderSn,"0"):i.isWeixin&&i.isPhone?i.orderPay(12,n,i.orderSn,"1"):i.isPhone?i.orderPay(11,n,i.orderSn,"2"):i.orderPay(10,n,i.orderSn,"3")}))},orderPay:function(t,n,i,o){var s=this,a={};a={_jv:{type:"trade/pay/order/".concat(i)},payment_type:t},this.$store.dispatch("jv/post",a).then((function(t){if(s.wxRes=t,"0"===o)s.wechatPay(t.wechat_js.timeStamp,t.wechat_js.nonceStr,t.wechat_js.package,t.wechat_js.signType,t.wechat_js.paySign);else if("1"===o)"undefined"===typeof WeixinJSBridge?document.addEventListener?document.addEventListener("WeixinJSBridgeReady",s.onBridgeReady(t),!1):document.attachEvent&&(document.attachEvent("WeixinJSBridgeReady",s.onBridgeReady(t)),document.attachEvent("onWeixinJSBridgeReady",s.onBridgeReady(t))):s.onBridgeReady(t);else if("2"===o){var n=encodeURI("".concat(DISCUZ_REQUEST_HOST,"pages/site/payH5"));window.location.href="".concat(t.wechat_h5_link,"&redirect_url=").concat(n)}else"3"===o&&t&&(s.codeUrl=t.wechat_qrcode,s.payShowStatus=!1,s.$refs.codePopup.open(),s.qrcodeShow=!0,u=setInterval((function(){1!==s.payStatus?(s.getOrderStatus(s.orderSn,o),e.hideLoading()):clearInterval(u)}),3e3))}))},getOrderStatus:function(e,t){var n=this;this.$store.dispatch("jv/get",["orders/".concat(e),{custom:{loading:!1}}]).then((function(e){n.payStatus=e.status,1===n.payStatus&&(n.payShowStatus=!1,n.coverLoading=!1,"3"===t&&(n.$refs.codePopup.close(),n.qrcodeShow=!1),window.location.href="/pages/home/index",n.$refs.toast.show({message:n.p.paySuccess}))})).catch((function(){n.coverLoading=!1,n.$refs.toast.show({message:n.pay.payFail})}))},onBridgeReady:function(e){var t=this;WeixinJSBridge.invoke("getBrandWCPayRequest",{appId:e.wechat_js.appId,timeStamp:e.wechat_js.timeStamp,nonceStr:e.wechat_js.nonceStr,package:e.wechat_js.package,signType:"MD5",paySign:e.wechat_js.paySign},(function(e){"get_brand_wcpay_request:ok"===e.err_msg?window.location.href="/pages/home/index":("get_brand_wcpay_request:cancel"===e.err_msg||"get_brand_wcpay_request:fail"===e.err_msg)&&clearInterval(u)})),u=setInterval((function(){1!==t.payStatus?t.getOrderStatus(t.orderSn,"1"):clearInterval(u)}),3e3)},wechatPay:function(t,n,i,o,s){e.requestPayment({provider:"wxpay",timeStamp:t,nonceStr:n,package:i,signType:o,paySign:s,success:function(){e.redirectTo({url:"/pages/home/index"})},fail:function(e){console.log("fail:".concat(JSON.stringify(e)))}})},submit:function(){var t=this;this.$store.getters["session/get"]("isLogin")?(this.payStatus=!1,this.payShowStatus=!0,this.$nextTick((function(){t.$refs.payShow.payClickShow()}))):(e.setStorage({key:"page",data:(0,s.getCurUrl)()}),this.mpLoginMode())},close:function(){this.$refs.auth.close()}}};t.default=c}).call(this,n("543d")["default"])},"9a05":function(e,t,n){"use strict";n.d(t,"b",(function(){return o})),n.d(t,"c",(function(){return s})),n.d(t,"a",(function(){return i}));var i={quiPage:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-page/qui-page")]).then(n.bind(null,"2bf0"))},quiSiteThread:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-site-thread/qui-site-thread")]).then(n.bind(null,"845d"))},quiButton:function(){return n.e("components/qui-button/qui-button").then(n.bind(null,"a67c"))},quiPay:function(){return Promise.all([n.e("common/vendor"),n.e("components/qui-pay/qui-pay")]).then(n.bind(null,"1802"))},uniPopup:function(){return n.e("components/uni-popup/uni-popup").then(n.bind(null,"f1be"))},quiIcon:function(){return n.e("components/qui-icon/qui-icon").then(n.bind(null,"5d1d"))},quiToast:function(){return n.e("components/qui-toast/qui-toast").then(n.bind(null,"6512"))}},o=function(){var e=this,t=e.$createElement,n=(e._self._c,e.isLogin?e.i18n.t("site.justonelaststepjoinnow"):null),i=e.isLogin?e.i18n.t("site.site"):null,o=e.forums.set_site&&e.forums.set_site.site_expire?e.i18n.t("site.periodvalidity"):null,s=e.forums.set_site&&e.forums.set_site.site_expire?e.i18n.t("site.day"):null,a=e.forums.set_site&&e.forums.set_site.site_expire?null:e.i18n.t("site.permanent"),r=e.isLogin?e.i18n.t("site.paynow"):null,u=e.isLogin?null:e.i18n.t("site.join"),c=e.isLogin?null:e.i18n.t("site.site"),d=e.payShowStatus?parseFloat(e.forums.set_site.site_price):null;e.$mp.data=Object.assign({},{$root:{g0:n,g1:i,g2:o,g3:s,g4:a,g5:r,g6:u,g7:c,m0:d}})},s=[]},"9ab8":function(e,t,n){"use strict";(function(e){n("3768");i(n("66fd"));var t=i(n("b09f"));function i(e){return e&&e.__esModule?e:{default:e}}e(t.default)}).call(this,n("543d")["createPage"])},b09f:function(e,t,n){"use strict";n.r(t);var i=n("9a05"),o=n("c22f");for(var s in o)"default"!==s&&function(e){n.d(t,e,(function(){return o[e]}))}(s);n("d419");var a,r=n("f0c5"),u=Object(r["a"])(o["default"],i["b"],i["c"],!1,null,null,null,!1,i["a"],a);t["default"]=u.exports},b654:function(e,t,n){},c22f:function(e,t,n){"use strict";n.r(t);var i=n("6007"),o=n.n(i);for(var s in i)"default"!==s&&function(e){n.d(t,e,(function(){return i[e]}))}(s);t["default"]=o.a},d419:function(e,t,n){"use strict";var i=n("b654"),o=n.n(i);o.a}},[["9ab8","common/runtime","common/vendor"]]]);